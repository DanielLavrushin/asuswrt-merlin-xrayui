import{_ as a,c as n,a as o,o as t}from"./app-eTybrgsj.js";const r="/asuswrt-merlin-xrayui/assets/20250803145430-U8FEzZPY.png",s="/asuswrt-merlin-xrayui/assets/20250803165533-AOMsvfNg.png",i="/asuswrt-merlin-xrayui/assets/20250803154415-D_kHzrVm.png",l="/asuswrt-merlin-xrayui/assets/20250803165744-BgaEyohN.png",d={};function c(h,e){return t(),n("div",null,e[0]||(e[0]=[o('<h1 id="dns-leaks-and-how-to-avoid-them" tabindex="-1"><a class="header-anchor" href="#dns-leaks-and-how-to-avoid-them"><span>DNS leaks and how to avoid them</span></a></h1><p>A DNS leak occurs when DNS (Domain Name System) requests go outside your encrypted tunnel. This allows your ISP or other parties on the path to see the domains you look up, even if your traffic itself is proxied or VPN-encrypted.</p><p>In this guide, “no DNS leak” means your DNS queries do not leave directly via your ISP link. They should traverse your tunnel (e.g., to your VPS) or another path you control.</p><h2 id="am-i-leaking" tabindex="-1"><a class="header-anchor" href="#am-i-leaking"><span>Am I leaking?</span></a></h2><p>Use any of these test services:</p><ul><li><a href="https://dnsleaktest.com/" target="_blank" rel="noopener noreferrer">dnsleaktest.com</a></li><li><a href="https://browserleaks.com/dns" target="_blank" rel="noopener noreferrer">browserleaks.com</a></li><li><a href="https://controld.com/tools/dns-leak-test" target="_blank" rel="noopener noreferrer">controld.com</a></li><li><a href="https://nordvpn.com/dns-leak-test/" target="_blank" rel="noopener noreferrer">nordvpn.com</a></li><li><a href="https://surfshark.com/dns-leak-test" target="_blank" rel="noopener noreferrer">surfshark.com</a></li><li><a href="https://www.astrill.com/dns-leak-test" target="_blank" rel="noopener noreferrer">atrill.com</a></li></ul><div class="hint-container tip"><p class="hint-container-title">How to read the results</p><ul><li>Ignore the final “protected/not protected” labels. Many services flag “not protected” if you aren’t using their resolver.</li><li>Focus on the list of DNS server IPs and their locations.</li><li>If the listed DNS servers are in your VPS location (or the resolver you chose) and you do not see your ISP’s DNS routed through your home country, you are not leaking to the ISP.</li></ul></div><p><strong>Solution</strong>: add a separate DNS inbound that explicitly dials a resolver and sends it via your outbound tunnel.</p><h2 id="how-to-configure-xrayui" tabindex="-1"><a class="header-anchor" href="#how-to-configure-xrayui"><span>How to configure XRAYUI</span></a></h2><div class="hint-container important"><p class="hint-container-title">Important</p><p>This manual is only applicable to the <code>XRAYUI v0.58.0</code> and above. You can check your version by executing the command <code>xrayui version</code>.</p></div><p>Your main inbound (e.g., dokodemo-door with <code>Follow redirect</code> = ON) is for transparent interception (TPROXY). It forwards to the original destination. When the router’s DNS forwarder (dnsmasq) talks to 127.0.0.1, there is no “original destination,” which can cause loops and cannot reliably forward DNS upstream.</p><h3 id="create-a-dedicated-dns-inbound" tabindex="-1"><a class="header-anchor" href="#create-a-dedicated-dns-inbound"><span>Create a dedicated DNS inbound</span></a></h3><p>Add a new DOKODEMO inbound:</p><ul><li>Port: choose a local port for DNS inbound (e.g., 55100)</li><li>Follow redirect: <strong>OFF</strong></li><li>Destination address: a public resolver you trust (e.g., 8.8.8.8, 1.1.1.1, AdGuard) or your own DNS on the VPS</li><li>Destination port: 53</li><li>Network: udp,tcp</li><li>Save.</li></ul><p><img src="'+r+'" alt="add dokodemo"></p><div class="hint-container note"><p class="hint-container-title">Note</p><p>Notice the checkbox <code>Follow redirect</code> is unchecked. This is important setting to make DNS not to leak. Dont&#39;t turn it on for this inbound configuration.</p></div><h3 id="configure-transport-tproxy-and-dialer" tabindex="-1"><a class="header-anchor" href="#configure-transport-tproxy-and-dialer"><span>Configure transport (tproxy) and dialer</span></a></h3><p>Open Transport for this DNS inbound → Transparent Proxy (tproxy) → Manage:</p><ul><li>Enable tproxy for this inbound (select <code>tproxy</code>).</li><li>Close this window and <code>apply</code> configuration changes in the main form.</li></ul><p><img src="'+s+'" alt="tproxy"></p><p>This pins the DNS outbound path to your tunnel, independent of routing rules.</p><h3 id="enable-prevent-dns-leaks" tabindex="-1"><a class="header-anchor" href="#enable-prevent-dns-leaks"><span>Enable “Prevent DNS leaks”</span></a></h3><p>Go to <code>General Settings</code> → <code>DNS</code> and turn on <code>Prevent DNS leaks</code>. This forces the router (dnsmasq) to use only your Xray DNS inbound and disables alternate system resolvers. <img src="'+i+`" alt="prevent dns leaks"></p><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>This switch does not create or configure the inbound; enable it after the DNS inbound is working. Turning it on too early can temporarily break name resolution.</p></div><h2 id="testing" tabindex="-1"><a class="header-anchor" href="#testing"><span>Testing</span></a></h2><p>For testing, create an additional rule that proxies traffic through your outbound and list the test services in it (for example, <code>browserleaks.com</code>).</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">browserleaks.com</span>
<span class="line">browserleaks.org</span>
<span class="line">browserleaks.net</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+l+'" alt="test dns leak"></p><p>Open <code>browserleaks.com</code> and verify that all reported sources come from your VPS.</p>',29)]))}const u=a(d,[["render",c]]),m=JSON.parse('{"path":"/en/dns-leak.html","title":"DNS leaks and how to avoid them","lang":"en-US","frontmatter":{},"git":{"updatedTime":1754237499000,"contributors":[{"name":"Daniel Lavrushin","username":"","email":"lavrushin@gmail.com","commits":3}],"changelog":[{"hash":"2283a6eb037abd1ee86634a1bbadbfedfd8a2886","time":1754237499000,"email":"lavrushin@gmail.com","author":"Daniel Lavrushin","message":"fix: update XRAYUI version requirement in DNS leak guide to v0.58.0"},{"hash":"d3e859d9bc1bb71a8b4dcc6985426d08b0c054ec","time":1754237425000,"email":"lavrushin@gmail.com","author":"Daniel Lavrushin","message":"fix: add additional browserleaks domains for DNS leak testing"},{"hash":"f24f79eb283441120fde63754f07f9c3e358bf28","time":1754233546000,"email":"lavrushin@gmail.com","author":"Daniel Lavrushin","message":"Add DNS leak prevention guide for XRAYUI in English and Russian"}]},"filePathRelative":"en/dns-leak.md"}');export{u as comp,m as data};
