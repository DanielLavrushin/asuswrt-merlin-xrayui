import{_ as n,c as s,a,o as r}from"./app-eTybrgsj.js";const o="/asuswrt-merlin-xrayui/assets/20250803155225-f3GwELhW.png",t="/asuswrt-merlin-xrayui/assets/20250803163324-oScUk-VS.png",i="/asuswrt-merlin-xrayui/assets/20250803163758-Cz6aNT-t.png",l="/asuswrt-merlin-xrayui/assets/20250803164552-CC270k7H.png",d="/asuswrt-merlin-xrayui/assets/20250803165258-DJs1p5sr.png",c={};function p(h,e){return r(),s("div",null,e[0]||(e[0]=[a('<h1 id="утечки-dns-и-как-их-избежать" tabindex="-1"><a class="header-anchor" href="#утечки-dns-и-как-их-избежать"><span>Утечки DNS и как их избежать</span></a></h1><p><strong>Утечка DNS</strong> возникает, когда DNS-запросы уходят вне вашего зашифрованного туннеля. Это позволяет вашему провайдеру (ISP) или другим участникам на пути видеть запрашиваемые домены, даже если сам трафик проксируется или зашифрован VPN.</p><p>В рамках этого руководства «без утечки DNS» означает, что ваши DNS-запросы <strong>не</strong> уходят напрямую через линк вашего провайдера. Они должны проходить через ваш туннель (например, к VPS) или иной контролируемый вами путь.</p><h2 id="проверка-на-утечки" tabindex="-1"><a class="header-anchor" href="#проверка-на-утечки"><span>Проверка на утечки</span></a></h2><p>Воспользуйтесь любым из сервисов:</p><ul><li><a href="https://www.browserscan.net/ru/dns-leak" target="_blank" rel="noopener noreferrer">browserscan.net</a></li><li><a href="https://dnsleaktest.com/" target="_blank" rel="noopener noreferrer">dnsleaktest.com</a></li><li><a href="https://browserleaks.com/dns" target="_blank" rel="noopener noreferrer">browserleaks.com</a></li><li><a href="https://controld.com/tools/dns-leak-test" target="_blank" rel="noopener noreferrer">controld.com</a></li><li><a href="https://nordvpn.com/ru/dns-leak-test/" target="_blank" rel="noopener noreferrer">nordvpn.com</a></li><li><a href="https://surfshark.com/ru/dns-leak-test" target="_blank" rel="noopener noreferrer">surfshark.com</a></li><li><a href="https://www.astrill.com/ru/dns-leak-test" target="_blank" rel="noopener noreferrer">atrill.com</a></li></ul><div class="hint-container tip"><p class="hint-container-title">Как читать результаты</p><ul><li>Игнорируйте итоговые метки вроде <strong>«protected/not protected»</strong>. Многие сайты считают «<strong>не защищённым</strong>» всё, что не использует их собственный резолвер.</li><li>Смотрите на список IP DNS-серверов и их географию.</li><li>Если указанные DNS-серверы находятся в локации вашего VPS (или в точке присутствия выбранного вами резолвера) и вы не видите DNS вашего провайдера из вашей страны — <strong>утечки к провайдеру нет</strong>.</li></ul></div><p><strong>Решение</strong>: добавьте отдельный DNS-входящий интерфейс (inbound), который явно дозванивается до резолвера и отправляет запросы через ваш исходящий туннель.</p><h2 id="настроика-в-xrayui" tabindex="-1"><a class="header-anchor" href="#настроика-в-xrayui"><span>Настройка в XRAYUI</span></a></h2><div class="hint-container important"><p class="hint-container-title">Важно</p><p>Руководство применимо к <strong>XRAYUI v0.58.0</strong> и новее. Проверить версию: <code>xrayui version</code>.</p></div><p>Ваш основной inbound (например, <code>dokodemo-door</code> с включённым <code>Follow redirect</code>) предназначен для прозрачного перехвата (<code>TPROXY</code>) и пересылает трафик на исходный адрес назначения. Когда DNS-форвардер роутера (dnsmasq) обращается к <code>127.0.0.1</code>, «исходного назначения» нет — это может вызывать зацикленность и нестабильную отправку DNS вверх по цепочке.</p><h3 id="создание-выделенного-dns-inbound" tabindex="-1"><a class="header-anchor" href="#создание-выделенного-dns-inbound"><span>Создание выделенного DNS-inbound</span></a></h3><p>Добавьте новый inbound типа <code>DOKODEMO</code>:</p><ul><li><strong>Порт</strong>: локальный порт для DNS-inbound (например, 55100)</li><li><strong>Следовать перенаправлению</strong>: ВЫКЛ</li><li><strong>Адрес назначения</strong>: публичный резолвер (например, 8.8.8.8, 1.1.1.1, AdGuard) или ваш собственный DNS на VPS</li><li><strong>Порт назначения</strong>: 53</li><li><strong>Сеть</strong>: udp,tcp</li><li>Сохраните.</li></ul><p><img src="'+o+'" alt="add dokodemo"></p><div class="hint-container note"><p class="hint-container-title">Заметка</p><p>Флажок <strong>Следовать перенаправлению</strong> должен быть снят. Это важно для предотвращения утечки DNS. Не включайте его для этого inbound.</p></div><h3 id="настроика-транспорта-tproxy-и-dialer" tabindex="-1"><a class="header-anchor" href="#настроика-транспорта-tproxy-и-dialer"><span>Настройка транспорта (tproxy) и dialer</span></a></h3><p>Откройте <strong>Трансопрт</strong> для этого DNS-inbound → <strong>Прозрачный прокси (tproxy)</strong> → <strong>настроить</strong>:</p><ul><li>Включите <code>tproxy</code> для inbound.</li><li>Закройте окно и нажмите <code>применить</code> в основной форме.</li></ul><p><img src="'+t+'" alt="tproxy"></p><h3 id="правила-маршрутизации-dns-запросов" tabindex="-1"><a class="header-anchor" href="#правила-маршрутизации-dns-запросов"><span>Правила маршрутизации DNS запросов</span></a></h3><p>Когда мы настроили исходящие и входящие прокси, необходимо также настроить и правило маршрутизации. Нам нужно, чтобы весь трафик с нашего нового inbound шел в нужный outbound.</p><ul><li>Создаем новое правило (желательно ближе к началу списка)</li><li>Выбираем только наш днс inbound в качестве входящего соединения</li><li>Выбираем наш прокси в качестве исходящего соединения</li><li>Сохраняем правило. Больше ничего в нем настраивать не нужно.</li></ul><p><img src="'+i+'" alt="правило"> Таким образом мы настроили маршрутизацию так, что все, что приходит в днс-инбаунд будет уходить в наш прокси аутбаунд.</p><h3 id="включение-«предотвращение-утечек-dns»" tabindex="-1"><a class="header-anchor" href="#включение-«предотвращение-утечек-dns»"><span>Включение «Предотвращение утечек DNS»</span></a></h3><p>Перейдите в <code>Общие настройки</code> → <code>DNS</code> и включите <strong>Предотвращение утечек DNS</strong>.</p><p>Опция заставляет роутер (dnsmasq) использовать только ваш DNS-inbound Xray и отключает альтернативные системные резолверы. <img src="'+l+`" alt="dns on"></p><div class="hint-container warning"><p class="hint-container-title">Примечание</p><p>Эта опция не создаёт и не настраивает <code>inbound</code> автоматически; включайте её после того, как DNS-inbound заработал. Раннее включение может временно нарушить резолвинг.</p></div><h2 id="тестирование" tabindex="-1"><a class="header-anchor" href="#тестирование"><span>Тестирование</span></a></h2><p>Для тестирования нам необходимо будет создать дополнительное правило - проксирование трафика через наш прокси и укажем сервисы выше в нем (для примера возьмем browserleaks.com)</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">browserleaks.com</span>
<span class="line">browserleaks.org</span>
<span class="line">browserleaks.net</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="`+d+'" alt="browserleaks to proxy"></p><p>Заходим на <code>browserleaks.com</code> и убеждаемся, что все источники идут через ваш VPS.</p>',33)]))}const m=n(c,[["render",p]]),g=JSON.parse('{"path":"/ru/dns-leak.html","title":"Утечки DNS и как их избежать","lang":"ru-RU","frontmatter":{},"git":{"updatedTime":1754237499000,"contributors":[{"name":"Daniel Lavrushin","username":"","email":"lavrushin@gmail.com","commits":3}],"changelog":[{"hash":"2283a6eb037abd1ee86634a1bbadbfedfd8a2886","time":1754237499000,"email":"lavrushin@gmail.com","author":"Daniel Lavrushin","message":"fix: update XRAYUI version requirement in DNS leak guide to v0.58.0"},{"hash":"d3e859d9bc1bb71a8b4dcc6985426d08b0c054ec","time":1754237425000,"email":"lavrushin@gmail.com","author":"Daniel Lavrushin","message":"fix: add additional browserleaks domains for DNS leak testing"},{"hash":"f24f79eb283441120fde63754f07f9c3e358bf28","time":1754233546000,"email":"lavrushin@gmail.com","author":"Daniel Lavrushin","message":"Add DNS leak prevention guide for XRAYUI in English and Russian"}]},"filePathRelative":"ru/dns-leak.md"}');export{m as comp,g as data};
