import{_ as t,a as r}from"./20250816183935-8xfQqTx3.js";import{_ as s,c as e,a as n,o}from"./app-BsG86pRf.js";const d="/asuswrt-merlin-xrayui/assets/20251205210728-ByLI1sDu.png",i="/asuswrt-merlin-xrayui/assets/20251205210907-BQ8NFZmf.png",l="/asuswrt-merlin-xrayui/assets/20251205210830-OSkEe9jD.png",h="/asuswrt-merlin-xrayui/assets/20251205211011-BDO9b0bL.png",c={};function p(g,a){return o(),e("div",null,[...a[0]||(a[0]=[n('<h1 id="логирование-в-xray" tabindex="-1"><a class="header-anchor" href="#логирование-в-xray"><span>Логирование в XRAY</span></a></h1><h2 id="что-такое-xray-logs" tabindex="-1"><a class="header-anchor" href="#что-такое-xray-logs"><span>Что такое Xray Logs?</span></a></h2><p>Журналы (логи) Xray позволяют отслеживать все соединения, проходящие через сервис xray-core. Это мощный инструмент для диагностики проблем, мониторинга активности и понимания того, как маршрутизируется трафик и пакеты.</p><h2 id="включение-логов" tabindex="-1"><a class="header-anchor" href="#включение-логов"><span>Включение логов</span></a></h2><h3 id="через-general-options" tabindex="-1"><a class="header-anchor" href="#через-general-options"><span>Через General Options</span></a></h3><ol><li>Откройте <strong>General Options</strong> в разделе <strong>Configuration</strong></li><li>Перейдите на вкладку <strong>Logs</strong></li><li>Настройте нужные параметры (описаны ниже)</li><li>Нажмите <strong>Save</strong></li></ol><p><img src="'+t+'" alt="logs"></p><h2 id="параметры-логирования" tabindex="-1"><a class="header-anchor" href="#параметры-логирования"><span>Параметры логирования</span></a></h2><h3 id="включить-логи-доступа" tabindex="-1"><a class="header-anchor" href="#включить-логи-доступа"><span>Включить логи доступа</span></a></h3><p>Записывает информацию о каждом соединении:</p><ul><li>Время подключения</li><li>IP-адрес источника</li><li>Адрес назначения</li><li>Используемый inbound и outbound</li><li>Тип маршрутизации (direct/rule)</li></ul><h3 id="включить-логи-ошибок" tabindex="-1"><a class="header-anchor" href="#включить-логи-ошибок"><span>Включить логи ошибок</span></a></h3><p>Записывает ошибки и предупреждения Xray. Необходимо для диагностики проблем с конфигурацией и соединениями.</p><h3 id="уровень-логирования" tabindex="-1"><a class="header-anchor" href="#уровень-логирования"><span>Уровень логирования</span></a></h3><p>Определяет подробность записей:</p><table><thead><tr><th>Уровень</th><th>Описание</th><th>Рекомендация</th></tr></thead><tbody><tr><td><code>none</code></td><td>Логи отключены</td><td>Не рекомендуется</td></tr><tr><td><code>error</code></td><td>Только критические ошибки</td><td>Для стабильных конфигураций</td></tr><tr><td><code>warning</code></td><td>Ошибки и предупреждения</td><td><strong>Рекомендуется для обычной работы</strong></td></tr><tr><td><code>info</code></td><td>Подробная информация</td><td>Для диагностики</td></tr><tr><td><code>debug</code></td><td>Максимальная детализация</td><td>Только для отладки</td></tr></tbody></table><div class="hint-container warning"><p class="hint-container-title">Примечание</p><p>Уровень <code>debug</code> создаёт большой объём записей и может влиять на производительность. Используйте только для временной диагностики.</p></div><h3 id="включить-логи-dns" tabindex="-1"><a class="header-anchor" href="#включить-логи-dns"><span>Включить логи DNS</span></a></h3><p>Записывает DNS-запросы, обрабатываемые встроенным DNS-сервером Xray. Полезно для:</p><ul><li>Проверки работы DNS-правил</li><li>Диагностики проблем с разрешением доменов</li><li>Мониторинга DNS-активности</li></ul><h3 id="включить-логи-dnsmasq" tabindex="-1"><a class="header-anchor" href="#включить-логи-dnsmasq"><span>Включить логи dnsmasq</span></a></h3><p>Заменяет IP-адреса на доменные имена в логах доступа. Делает логи более читаемыми — вместо <code>93.184.216.34</code> вы увидите <code>example.com</code>.</p><div class="hint-container warning"><p class="hint-container-title">Ограничения отображения доменов</p><p>Xray в Access Logs записывает только IP-адреса назначения, а не доменные имена. <code>XRAYUI</code> решает эту проблему сопоставлением IP из логов Xray с записями <code>dnsmasq</code>, где фиксируются DNS-резолвы.</p><p>Однако такой подход имеет фундаментальное ограничение: множество доменов могут резолвиться в один IP-адрес. Это типично для сайтов за CDN (<code>Cloudflare</code>, <code>Akamai</code>, <code>Fastly</code>) или на shared-хостинге, где балансировщик нагрузки обслуживает тысячи доменов с одного адреса.</p><p>В результате в логах может отображаться некорректный домен — тот, который последним резолвился в данный IP, а не тот, к которому фактически обращался клиент.</p><p>Для точного определения доменов используйте <a href="b4sni">B4SNI</a> — он захватывает SNI непосредственно из TLS-хендшейка.</p></div><h3 id="максимальныи-размер-лога" tabindex="-1"><a class="header-anchor" href="#максимальныи-размер-лога"><span>Максимальный размер лога</span></a></h3><p>Порог в мегабайтах, при достижении которого запускается автоматическая ротация. Рекомендуемые значения: 5-20 МБ в зависимости от нагрузки.</p><h3 id="очищать-логи-при-перезапуске-xray" tabindex="-1"><a class="header-anchor" href="#очищать-логи-при-перезапуске-xray"><span>Очищать логи при перезапуске Xray</span></a></h3><p>Если включено, файлы логов очищаются при каждом перезапуске службы Xray.</p><h2 id="просмотр-логов" tabindex="-1"><a class="header-anchor" href="#просмотр-логов"><span>Просмотр логов</span></a></h2><p>После включения логирования в нижней части главной страницы появится раздел <strong>Logs</strong>.</p><p><img src="'+r+'" alt="выбор логов"></p><h3 id="выбор-типа-логов" tabindex="-1"><a class="header-anchor" href="#выбор-типа-логов"><span>Выбор типа логов</span></a></h3><ul><li><strong>Access Logs</strong> — записи о соединениях (табличный вид)</li><li><strong>Error Logs</strong> — ошибки и предупреждения (текстовый вид)</li></ul><h3 id="интерфеис-просмотра" tabindex="-1"><a class="header-anchor" href="#интерфеис-просмотра"><span>Интерфейс просмотра</span></a></h3><p>Нажмите <strong>display</strong> для открытия окна просмотра логов. Логи автоматически обновляются каждые 2 секунды.</p><h3 id="понимание-access-logs" tabindex="-1"><a class="header-anchor" href="#понимание-access-logs"><span>Понимание Access Logs</span></a></h3><p><img src="'+d+'" alt="logs"></p><p>Каждая запись содержит:</p><table><thead><tr><th>Поле</th><th>Описание</th></tr></thead><tbody><tr><td><strong>Time</strong></td><td>Время соединения (ЧЧ:ММ:СС)</td></tr><tr><td><strong>Source</strong></td><td>Устройство-источник (имя или IP)</td></tr><tr><td><strong>Target</strong></td><td>Адрес назначения и порт</td></tr><tr><td><strong>Inbound</strong></td><td>Тег входящего прокси</td></tr><tr><td><strong>Outbound</strong></td><td>Тег исходящего прокси и тип маршрутизации</td></tr></tbody></table><h4 id="индикаторы-протоколов" tabindex="-1"><a class="header-anchor" href="#индикаторы-протоколов"><span>Индикаторы протоколов</span></a></h4><p><img src="'+i+'" alt="tcpudp"></p><ul><li><strong>TCP</strong> (синий) — TCP-соединение</li><li><strong>UDP</strong> (жёлтый) — UDP-соединение</li></ul><h4 id="индикаторы-маршрутизации" tabindex="-1"><a class="header-anchor" href="#индикаторы-маршрутизации"><span>Индикаторы маршрутизации</span></a></h4><p><img src="'+l+'" alt="rules"></p><ul><li><strong>direct</strong> (зелёный ✓) — прямое соединение через <code>FREEDOM</code></li><li><strong>rule</strong> (розовый ❯) — соединение по правилу маршрутизации</li></ul><h4 id="dns-записи" tabindex="-1"><a class="header-anchor" href="#dns-записи"><span>DNS-записи</span></a></h4><p><img src="'+h+'" alt="dns"></p><h3 id="фильтрация-логов" tabindex="-1"><a class="header-anchor" href="#фильтрация-логов"><span>Фильтрация логов</span></a></h3><p>Используйте поля поиска в заголовках столбцов:</p><ul><li><strong>Source</strong> — фильтр по IP, имени устройства или порту источника</li><li><strong>Target</strong> — фильтр по адресу назначения</li><li><strong>Inbound</strong> — фильтр по входящему тегу</li><li><strong>Outbound</strong> — фильтр по исходящему тегу</li></ul><h3 id="кнопка-raw" tabindex="-1"><a class="header-anchor" href="#кнопка-raw"><span>Кнопка Raw</span></a></h3><p>Открывает сырой файл логов в новой вкладке браузера для детального анализа или копирования.</p><h2 id="интеграция-со-scribe" tabindex="-1"><a class="header-anchor" href="#интеграция-со-scribe"><span>Интеграция со Scribe</span></a></h2><p><a href="https://github.com/AMTM-OSR/scribe" target="_blank" rel="noopener noreferrer">Scribe</a> — популярный менеджер логов для ASUSWRT-Merlin.</p><h3 id="включение-интеграции" tabindex="-1"><a class="header-anchor" href="#включение-интеграции"><span>Включение интеграции</span></a></h3><ol><li>Убедитесь, что Scribe установлен на роутере</li><li>В <strong>General Options → Logs</strong> включите <strong>Интеграция логов XRAYUI с Scribe</strong></li><li>Сохраните настройки</li></ol><p>После этого логи XRAYUI будут доступны в веб-интерфейсе Scribe.</p><h2 id="ротация-логов" tabindex="-1"><a class="header-anchor" href="#ротация-логов"><span>Ротация логов</span></a></h2><p>XRAYUI автоматически управляет размером логов:</p><ul><li>Проверка размера каждые 15 минут (cron)</li><li>При превышении лимита старые записи архивируются</li><li>Хранится до 2 ротированных копий</li></ul><p>Конфигурация logrotate создаётся автоматически в <code>/opt/etc/logrotate.d/xrayui</code>.</p><h2 id="расположение-фаилов" tabindex="-1"><a class="header-anchor" href="#расположение-фаилов"><span>Расположение файлов</span></a></h2><table><thead><tr><th>Файл</th><th>Путь</th></tr></thead><tbody><tr><td>Access Log</td><td><code>/opt/share/xrayui/logs/xray_access.log</code></td></tr><tr><td>Error Log</td><td><code>/opt/share/xrayui/logs/xray_error.log</code></td></tr><tr><td>DNS-кэш</td><td><code>/opt/share/xrayui/logs/xrayui_ip2domain.cache</code></td></tr></tbody></table><div class="hint-container caution"><p class="hint-container-title">Износ флеш-памяти</p><p>Постоянное логирование создаёт интенсивную нагрузку на запись. USB-накопители и встроенная NAND-память роутера имеют ограниченный ресурс циклов перезаписи (обычно 3 000–10 000 для бюджетных флешек).</p><p>При активном трафике <code>Access Logs</code> могут генерировать сотни записей в минуту. Отключайте логирование после завершения диагностики или используйте накопитель, который не жалко.</p></div>',63)])])}const m=s(c,[["render",p]]),x=JSON.parse('{"path":"/ru/logs.html","title":"Логирование в XRAY","lang":"ru-RU","frontmatter":{},"git":{"updatedTime":1764965920000,"contributors":[{"name":"Daniel Lavrushin","username":"","email":"lavrushin@gmail.com","commits":1}],"changelog":[{"hash":"e1465458a7974a6327c34e43e045b7321007cb82","time":1764965920000,"email":"lavrushin@gmail.com","author":"Daniel Lavrushin","message":"feat: add logging documentation and images for XRAY UI"}]},"filePathRelative":"ru/logs.md"}');export{m as comp,x as data};
