# B4SNI Logs - Монитор SNI трафика

## Что такое B4SNI Logs?

`B4SNI Logs` - это функция мониторинга сети в `XRAYUI`, которая захватывает и отображает информацию `Server Name Indication` (SNI) из вашего сетевого трафика. SNI - это имя хоста, которое устройства запрашивают при установлении HTTPS-соединений, что позволяет видеть, к каким веб-сайтам и сервисам осуществляется доступ через вашу сеть.

## Как использовать

### Запуск монитора

1. Перейдите в раздел **B4SNI Logs** в интерфейсе `XRAYUI` (в самом низу главного экрана)
   ![b4sni](../.vuepress/public/images/b4sni/20251025222843.png)
2. Нажмите кнопку **start** для начала захвата SNI данных
3. Кнопка изменится на **Stop** когда служба запущена

### Просмотр логов

1. Нажмите кнопку **display** чтобы открыть просмотр логов
2. Логи будут автоматически обновляться каждые 3 секунды пока окно открыто

![snilogs](../.vuepress/public/images/b4sni/20260222195218.png)

### Режимы просмотра

Просмотрщик логов предоставляет три вкладки для анализа трафика:

#### По устройствам (By Device)

Группирует все захваченные домены по устройству LAN, которое к ним обращалось. Каждое устройство отображается как сворачиваемая карточка:

- Имя устройства (или IP-адрес если не распознано) и общее количество обращений
- Таблица всех доменов, к которым обращалось устройство
- Количество обращений к каждому домену, значки протоколов и время последнего обращения
- Кнопка **+ Rule** у каждого домена для быстрого добавления в правило маршрутизации

Карточки отсортированы по общему количеству обращений — наиболее активные устройства отображаются первыми.

#### По доменам (By Domain)

Агрегированная таблица всех захваченных доменов со всех устройств, отсортированная по количеству обращений:

| Столбец | Описание |
| --- | --- |
| Domain | Доменное имя SNI |
| Hits | Общее количество соединений с этим доменом |
| Protocols | Значки `TCP` (синий) и/или `UDP` (жёлтый) |
| Devices | Теги устройств, которые обращались к домену |
| Last Seen | Время последнего соединения |
| Action | Кнопка **+ Rule** для добавления домена в правило маршрутизации |

Используйте поле поиска для фильтрации доменов по имени.

#### Живой поток (Live Stream)

Просмотр логов в реальном времени, показывающий отдельные события соединений в обратном хронологическом порядке. Каждая запись содержит:

| Поле | Описание |
| --- | --- |
| Time | Когда было установлено соединение (формат ЧЧ:ММ:СС) |
| Protocol | Либо `TCP` (синий значок) или `UDP` (жёлтый значок) |
| Source | Устройство, устанавливающее соединение — показывает имя устройства если распознано, иначе IP-адрес, плюс номер порта |
| Destination | Сервер, к которому подключаются (IP:порт) |
| SNI | Доменное имя, к которому осуществляется доступ (например, google.com, netflix.com) |

Используйте поля поиска по столбцам для фильтрации по Protocol, Source, Destination или SNI.

### Панель статистики

В верхней части просмотрщика логов вы увидите:

- **Total**: Общее количество зарегистрированных соединений
- **TCP/UDP**: Разбивка по типу протокола
- **Unique SNI**: Количество различных доменов, к которым был доступ
- **Top Domain**: Наиболее часто запрашиваемый домен и его количество обращений
- **Most Active Device**: Устройство с наибольшим количеством соединений

### Добавление доменов в правила маршрутизации

Вы можете добавлять домены напрямую из логов SNI в правила маршрутизации Xray, не покидая просмотрщик логов:

1. Нажмите кнопку **+ Rule** рядом с любым доменом
2. Появится всплывающее окно со списком существующих правил маршрутизации
3. Выберите существующее правило для добавления домена, **или** выберите **New rule** и укажите имя правила и outbound тег
4. Нажмите **Confirm** для добавления домена

#### Массовый выбор

В режимах **По устройствам** и **По доменам** можно выбрать несколько доменов одновременно:

- Используйте чекбокс рядом с каждым доменом для индивидуального выбора
- В режиме **По устройствам** используйте чекбокс на уровне устройства для выбора всех его доменов
- В режиме **По доменам** используйте верхний чекбокс для выбора всех видимых доменов
- При выборе доменов появляется панель массовых действий — нажмите **Add selected to rule** чтобы добавить их все сразу

### Управление логами

- **Clear Logs**: Нажмите чтобы удалить все захваченные логи и начать заново
- **Export CSV**: Загрузить текущее представление как файл электронной таблицы. Экспортируемые столбцы зависят от активной вкладки:
  - **Live Stream**: Time, Protocol, Source IP, Source Port, Device, Dest IP, Dest Port, SNI
  - **By Domain**: Domain, Hits, Protocols, Devices, First Seen, Last Seen
  - **By Device**: Device, IP, Domain, Hits, Protocols
- **Raw**: Просмотреть сырой файл логов в новой вкладке браузера

### Остановка монитора

Нажмите кнопку **stop** когда закончите мониторинг для экономии системных ресурсов.

### Примечание о конфиденциальности

B4SNI Logs захватывает только доменные имена (SNI), а не фактическое содержимое вашего интернет-трафика. Это как видеть адрес на конверте, не открывая письмо.

## Устранение неполадок

### Логи не появляются

- Убедитесь, что служба запущена (нажата кнопка `start`)
- Подождите несколько секунд для захвата трафика
- Попробуйте обновить страницу
- Проверьте, есть ли фактическая сетевая активность

### Имена устройств не отображаются

- Имена устройств появляются только для распознанных устройств в вашей сети
- Новым устройствам может потребоваться время для идентификации
- Гостевые устройства могут показывать только IP адреса

### Служба не запускается

- Возможно запущена другая служба мониторинга
- Попробуйте остановить и запустить снова
- Обновите интерфейс XRAYUI

### Логи становятся слишком большими

- Система автоматически ограничивает размер файла логов и ротирует их
- Периодически используйте "Clear Logs" для начала с чистого листа
- Экспортируйте важные логи перед очисткой

## Часто задаваемые вопросы

**В: Замедляет ли это мой интернет?**

О: Нет, B4SNI Logs работает пассивно и не влияет на производительность сети.

**В: Могу ли я видеть, что люди просматривают?**
О: Вы можете видеть доменные имена (как youtube.com), но не конкретные страницы или содержимое.

**В: Как долго хранятся логи?**

О: Логи хранятся до тех пор, пока вы их не очистите или не перезапустите службу. Система автоматически управляет размером файла.

**В: Могу ли я мониторить только определённые устройства?**

О: Мониторится весь трафик, но вы можете использовать вкладку **По устройствам** для фокусировки на конкретном устройстве, или фильтры в режиме **Живой поток** для просмотра трафика определённого источника.

**В: Можно ли добавить наблюдаемые домены в правила маршрутизации?**

О: Да! Используйте кнопку **+ Rule** у любого домена, или выберите несколько доменов и используйте массовое добавление. Это позволяет быстро создавать правила маршрутизации на основе реального трафика.
