# Руководство по подпискам

Подписка в мире XRAY — удобный способ упростить обслуживание конфигурации между сервером и клиентом. После завершения настройки вашего сервера XRAY он может предоставить URL подписки, который может использовать любой клиент, совместимый с XRAY. Подписки не являются встроенной функцией самого XRAY Core — многие сторонние серверные панели и интерфейсы добавляют этот слой удобства.

Все больше проектов умеют генерировать URL подписки для вашего сервера. Загляните на [домашнюю страницу XRAY Core](https://github.com/XTLS/Xray-core), чтобы найти поддерживаемые инструменты и клиенты.

## Подписки «под капотом»

Есть два варианта URL подписок:

- **Subscription protocol link (a token)**: начинается с префикса протокола прокси, такого как `ss://`, `vless://`, `vmess://` и т. д. Может быть закодирована в Base64, поэтому содержимое не читается напрямую.
- **Subscription source**: список нескольких конфигураций прокси (каждая на своей строке, закодированы).

  > [!info]
  > Единственная по-настоящему важная разница — гранулярность: ссылка протокола отдаёт `one` прокси, источник — `many`.

  > [!warning]
  > Открытие любой из ссылок в браузере может показать “абракадабру” — это просто Base64. XRAYUI декодирует всё за вас. Если любопытно — не обязательно! — можете декодировать сами на [base64decode.org](https://www.base64decode.org/).

  > [!warning]
  > Разбор может быть непростым. Если что-то ведёт себя странно, загляните в наш [Telegram-группу](https://t.me/asusxray) — поможем.

### Subscription Protocol Link

Одиночная ссылка на прокси — возможно, из `3x-u`, `Marzban` или любого другого [провайдера](https://github.com/XTLS/Xray-core). Пример декодированного содержимого может выглядеть так:

```text:no-line-numbers
vless://05519058-d2ac-4f28-9e4a-2b2a1386749e@1.1.1.1:22222?path=/telegram-channel-vlessconfig-ws&security=tls&encryption=none&host=somedomainname.com&type=ws&sni=telegram-channel-vlessconfig.sohala.uk#Telegram @VlessConfig
```

> [!info]
> Содержимое ссылки при открытии в браузере может быть закодировано, и вы не поймёте его сразу. Это нормально — просто предоставьте ссылку.

### Subscription Source Link

Ссылка-источник подписки. Источник подписки — это ссылка, содержащая больше одного протокола. По сути это просто список протоколов (много строк со случайными `ss://`, `vless://` и т. п.).

## XRAYUI: Protocol Link

Начнём со ссылки протокола (надеемся, вы не пропустили важную предыдущую часть, верно?).

XRAYUI ожидает, что вы знаете протокол ссылки. Поэтому сначала нужно создать элемент outbound соответствующего протокола.

В разделе Outbounds выберите нужный протокол в выпадающем списке и создайте его. Например, у вас есть ссылка

```text:no-line-numbers
https://yourserver:2096/asd7696asf98df/d0f97sd00df7s09s8df
```

Вставьте её в поле `Subscription URL`  
![subscriptions protocol](../.vuepress/public/images/subscriptions/20250731210146.png)  
Все зависящие от подписки поля становятся неактивными. Это означает, что эти поля и параметры будут управляться вашей подпиской.

Нажмите `save`, чтобы сохранить изменения.

> [!warning]  
> Помните: это не применяет изменения конфигурации. Всё равно нужно нажать `apply` в основной форме, чтобы изменения были отправлены на бэкенд и сохранены.

Когда вы примените изменения основной формы, правки вступят в силу, и страница перезагрузится. Рядом с вашим outbound появится значок ссылки, указывающий, что этот outbound управляется ссылкой подписки.  
![proxy subscription line](../.vuepress/public/images/subscriptions/20250731210735.png)

> [!info]  
> Несмотря на слово «подписка» в названии, недостаточно просто обновить удалённую сторону. Чтобы изменения вступили в силу, каждый раз после изменения вашей подписки нажимайте кнопку `apply` в XRAYUI. В этом случае XRAYUI перезагрузит и применит обновлённые параметры.

## XRAYUI: Source Link

Ссылка-источник — это ссылка, содержащая более одного протокола. Она не будет работать как ссылка протокола, описанная выше, — настройка выполняется иначе.

Перейдите в `General Options` в `Configuration Section` и переключитесь на вкладку `Subscriptions`.  
![source link](../.vuepress/public/images/subscriptions/20250731213156.png)  
Можно сохранить — окно будет перезагружено. Или укажите временную ссылку и нажмите кнопку `fetch` под текстовой областью.

![fetch](../.vuepress/public/images/subscriptions/20250731213401.png)

Система получит ссылки из источника подписки. Визуально ничего не произошло — это нормально. Можно закрыть окно.

Однако если вы создадите новый исходящий прокси (outbound), вы получите список доступных подписок, из которого можно выбрать в списке `Available Subscription Configuration`  
![available subscriptions](../.vuepress/public/images/subscriptions/20250731213630.png)

> [!warning]  
> Выпадающий список доступен только если из URL был получен соответствующий тип подписки.

Теперь вы можете выбрать объект подписки в выпадающем списке, и параметры конфигурации применятся автоматически.

> [!warning]
> Разница между источником подписки и ссылкой протокола — в гранулярности. Если ссылка содержит один элемент — вставьте её в поле Subscription URL, и при перезапуске службы произойдёт автоматическая перезагрузка.
> Если же она содержит больше одного источника, для каждого outbound будет отображаться выпадающий список. Это потребует повторного применения настроек при изменениях на удалённой стороне.

## Автоматическое обновление подписок

По умолчанию источники подписок загружаются только при ручном нажатии кнопки `Fetch`. Если ваш провайдер подписок часто обновляет эндпоинты серверов, можно включить автоматическое обновление, чтобы список серверов всегда оставался актуальным.

![autosubru](../.vuepress/public/images/subscriptions/20260220235835.png)

В `General Options` → вкладка `Subscriptions` найдите настройку **Auto-refresh interval** и выберите расписание:

- **Disabled** — только ручное обновление (по умолчанию)
- **3 hours** — обновление каждые 3 часа
- **6 hours** — каждые 6 часов
- **12 hours** — каждые 12 часов

Обновление выполняется в фоновом режиме через cron-задачу. Используются те же ссылки подписок, которые вы уже настроили в текстовом поле выше.

## Автоматическое переключение (Auto-Fallback)

Автоматическое переключение предназначено для ситуаций, когда ваш провайдер или сеть блокирует прокси-эндпоинт. При включении XRAYUI будет периодически проверять, доступен ли ваш активный прокси. Если будет обнаружено, что эндпоинт недоступен, система автоматически переключится на следующий рабочий сервер из пула подписки. Правила маршрутизации, DNS-настройки и всё остальное останутся нетронутыми — изменятся только параметры подключения.

### Как включить

Настройка состоит из двух частей:

**1. Глобальный переключатель** — В `General Options` → вкладка `Subscriptions`:

- Включите чекбокс **Auto-fallback**. Это активирует систему мониторинга состояния.
- Выберите **Health check interval** (2, 5 или 10 минут). Это определяет, как часто система проверяет доступность ваших эндпоинтов.

**2. Включение для каждого outbound** — В настройках каждого outbound:

- Сначала выберите эндпоинт из выпадающего списка `Available Subscription Configuration` (для этого необходимо предварительно загрузить источники подписок).
- Затем включите чекбокс **Auto-fallback pool**. Это привязывает outbound к пулу подписки для автоматического восстановления.

> [!info]
> Только outbound-ы с включённым чекбоксом **Auto-fallback pool** участвуют в автоматическом переключении. Остальные outbound-ы остаются без изменений.

![subautooutboundru](../.vuepress/public/images/subscriptions/20260220235930.png)

### Как это работает

Система проверяет outbound-ы с включённым пулом по настроенному расписанию. Для каждого из них:

1. Сначала проверяется доступность эндпоинта. Если у вас включена функция **Connection check** (в General Options), используются данные Observatory от самого Xray — наиболее точный метод. В противном случае выполняется простая TCP-проверка.
2. При одиночном сбое переключение не происходит. Система ждёт **3 последовательных неудачи**, чтобы не реагировать на временные сетевые проблемы.
3. После 3 неудач система просматривает пул подписки для данного протокола, проверяет каждого кандидата и переключается на первый доступный.
4. Xray перезапускается автоматически после переключения.

Встроенное ограничение безопасности предотвращает чрезмерное переключение — не более 5 переключений в час на один outbound. Если все эндпоинты в пуле недоступны, система очищает список неудачных и повторяет попытку в следующем цикле.
