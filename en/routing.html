<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Routing Rules Guide | XrayUI</title><meta name="description" content="Manage Xray-core from your Asus router">
    <link rel="preload" href="/asuswrt-merlin-xrayui/assets/style-KwXFwar5.css" as="style"><link rel="stylesheet" href="/asuswrt-merlin-xrayui/assets/style-KwXFwar5.css">
    <link rel="modulepreload" href="/asuswrt-merlin-xrayui/assets/app-eTybrgsj.js"><link rel="modulepreload" href="/asuswrt-merlin-xrayui/assets/routing.html-CMUZd7BC.js"><link rel="modulepreload" href="/asuswrt-merlin-xrayui/assets/20251025013437-C6_y1YdW.js">
    <link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/index.html-ZL0zZxfL.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/b4sni.html-Ba3o12Ck.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/br-policy.html-C-4UgqTA.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/changelog.html-CKPX_XYB.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/cli.html-Dqe7zj4l.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/custom-geodata.html-USELws9i.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/dns-leak.html-_hjwJI3_.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/general-options.html-DlpELEzm.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/import-config.html-_P18D6km.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/install.html-C42kObjO.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/interface.html-DcAHGYjV.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/rtls-scanner.html-BTaMzcn2.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/share-config.html-CwlwcHw_.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/subscriptions.html-BZ6vrsbx.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/tproxy.html-K22hdfAS.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/v2dat.html-1iHror3G.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/b4sni.html-BixeTGKS.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/br-policy.html-DIrOI7N7.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/changelog.html-Cb6G9TzF.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/cli.html-HzOqq1hm.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/custom-geodata.html-QDGiGKSh.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/dns-leak.html-bisDTiaZ.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/general-options.html-BZiDNEGz.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/import-config.html-CM88-Y8F.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/index.html-C2vSMad_.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/install.html-B-I2-Ks-.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/interface.html-CNiu5LVc.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/routing.html-BVi6wY0Z.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/rtls-scanner.html-j_0TSXr8.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/share-config.html-tq5eAy9L.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/subscriptions.html-D72aw0Ef.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/tproxy.html-DCXOnUpY.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/v2dat.html-1Jijv1yf.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/404.html-D8InpyWK.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/asuswrt-merlin-xrayui/"><img class="vp-site-logo" src="/asuswrt-merlin-xrayui/images/logo.png" alt="XrayUI"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">XrayUI</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Home"><span class="title">Home</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Home"><span class="title">Home</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/install" aria-label="How to install"><!--[--><!--[--><!--]--><!--]-->How to install<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/interface" aria-label="Interface Overview"><!--[--><!--[--><!--]--><!--]-->Interface Overview<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/asuswrt-merlin-xrayui/en/routing" aria-label="Routing Rules Guide"><!--[--><!--[--><!--]--><!--]-->Routing Rules Guide<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/general-options" aria-label="General Options"><!--[--><!--[--><!--]--><!--]-->General Options<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/import-config" aria-label="Importing the Configuration"><!--[--><!--[--><!--]--><!--]-->Importing the Configuration<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/br-policy" aria-label="Bypass/Redirect Policy"><!--[--><!--[--><!--]--><!--]-->Bypass/Redirect Policy<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/subscriptions" aria-label="Subscription Management"><!--[--><!--[--><!--]--><!--]-->Subscription Management<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/dns-leak" aria-label="DNS Leak"><!--[--><!--[--><!--]--><!--]-->DNS Leak<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/share-config" aria-label="Securely Share Config"><!--[--><!--[--><!--]--><!--]-->Securely Share Config<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/tproxy" aria-label="Transparent Proxy (TPROXY)"><!--[--><!--[--><!--]--><!--]-->Transparent Proxy (TPROXY)<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/rtls-scanner" aria-label="Reality TLS Scanner"><!--[--><!--[--><!--]--><!--]-->Reality TLS Scanner<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/custom-geodata" aria-label="Custom Geosite Files"><!--[--><!--[--><!--]--><!--]-->Custom Geosite Files<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/v2dat" aria-label="Inspect Geosite and GeoIP Databases"><!--[--><!--[--><!--]--><!--]-->Inspect Geosite and GeoIP Databases<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/b4sni" aria-label="B4SNI Inspection"><!--[--><!--[--><!--]--><!--]-->B4SNI Inspection<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/cli" aria-label="CLI"><!--[--><!--[--><!--]--><!--]-->CLI<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/changelog" aria-label="Changelog"><!--[--><!--[--><!--]--><!--]-->Changelog<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/asuswrt-merlin-xrayui/en/routing" aria-label="English"><!--[--><!--[--><!--]--><!--]-->English<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/" aria-label="Russian"><!--[--><!--[--><!--]--><!--]-->Russian<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Home"><span class="title">Home</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Home"><span class="title">Home</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/install" aria-label="How to install"><!--[--><!--[--><!--]--><!--]-->How to install<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/interface" aria-label="Interface Overview"><!--[--><!--[--><!--]--><!--]-->Interface Overview<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/asuswrt-merlin-xrayui/en/routing" aria-label="Routing Rules Guide"><!--[--><!--[--><!--]--><!--]-->Routing Rules Guide<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/general-options" aria-label="General Options"><!--[--><!--[--><!--]--><!--]-->General Options<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/import-config" aria-label="Importing the Configuration"><!--[--><!--[--><!--]--><!--]-->Importing the Configuration<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/br-policy" aria-label="Bypass/Redirect Policy"><!--[--><!--[--><!--]--><!--]-->Bypass/Redirect Policy<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/subscriptions" aria-label="Subscription Management"><!--[--><!--[--><!--]--><!--]-->Subscription Management<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/dns-leak" aria-label="DNS Leak"><!--[--><!--[--><!--]--><!--]-->DNS Leak<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/share-config" aria-label="Securely Share Config"><!--[--><!--[--><!--]--><!--]-->Securely Share Config<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/tproxy" aria-label="Transparent Proxy (TPROXY)"><!--[--><!--[--><!--]--><!--]-->Transparent Proxy (TPROXY)<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/rtls-scanner" aria-label="Reality TLS Scanner"><!--[--><!--[--><!--]--><!--]-->Reality TLS Scanner<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/custom-geodata" aria-label="Custom Geosite Files"><!--[--><!--[--><!--]--><!--]-->Custom Geosite Files<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/v2dat" aria-label="Inspect Geosite and GeoIP Databases"><!--[--><!--[--><!--]--><!--]-->Inspect Geosite and GeoIP Databases<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/b4sni" aria-label="B4SNI Inspection"><!--[--><!--[--><!--]--><!--]-->B4SNI Inspection<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/cli" aria-label="CLI"><!--[--><!--[--><!--]--><!--]-->CLI<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/en/changelog" aria-label="Changelog"><!--[--><!--[--><!--]--><!--]-->Changelog<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/asuswrt-merlin-xrayui/en/routing" aria-label="English"><!--[--><!--[--><!--]--><!--]-->English<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/" aria-label="Russian"><!--[--><!--[--><!--]--><!--]-->Russian<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Guides <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/en/install" aria-label="How to install"><!--[--><!--[--><!--]--><!--]-->How to install<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/en/interface" aria-label="Interface Overview"><!--[--><!--[--><!--]--><!--]-->Interface Overview<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/asuswrt-merlin-xrayui/en/routing" aria-label="Routing Rules Guide"><!--[--><!--[--><!--]--><!--]-->Routing Rules Guide<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/en/general-options" aria-label="General Options"><!--[--><!--[--><!--]--><!--]-->General Options<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/en/import-config" aria-label="Importing the Configuration"><!--[--><!--[--><!--]--><!--]-->Importing the Configuration<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/en/br-policy" aria-label="Bypass/Redirect Policy"><!--[--><!--[--><!--]--><!--]-->Bypass/Redirect Policy<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/en/subscriptions" aria-label="Subscription Management"><!--[--><!--[--><!--]--><!--]-->Subscription Management<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/en/dns-leak" aria-label="DNS Leak"><!--[--><!--[--><!--]--><!--]-->DNS Leak<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/en/share-config" aria-label="Securely Share Config"><!--[--><!--[--><!--]--><!--]-->Securely Share Config<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/en/tproxy" aria-label="Transparent Proxy (TPROXY)"><!--[--><!--[--><!--]--><!--]-->Transparent Proxy (TPROXY)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/en/rtls-scanner" aria-label="Reality TLS Scanner"><!--[--><!--[--><!--]--><!--]-->Reality TLS Scanner<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/en/custom-geodata" aria-label="Custom Geosite Files"><!--[--><!--[--><!--]--><!--]-->Custom Geosite Files<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/en/v2dat" aria-label="Inspect Geosite and GeoIP Databases"><!--[--><!--[--><!--]--><!--]-->Inspect Geosite and GeoIP Databases<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/en/b4sni" aria-label="B4SNI Inspection"><!--[--><!--[--><!--]--><!--]-->B4SNI Inspection<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/asuswrt-merlin-xrayui/en/cli" aria-label="CLI"><!--[--><!--[--><!--]--><!--]-->CLI<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/asuswrt-merlin-xrayui/en/changelog" aria-label="Changelog"><!--[--><!--[--><!--]--><!--]-->Changelog<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="routing-rules-guide" tabindex="-1"><a class="header-anchor" href="#routing-rules-guide"><span>Routing Rules Guide</span></a></h1><p>Routing rules are the core of Xray&#39;s traffic control system. They determine which outbound connection (outbound proxy (<code>vless</code>/<code>vmess</code>/<code>xhttp</code> etc), direct(<code>freedom</code>), or block(<code>blackhole</code>)) should handle specific traffic based on various criteria like domains, IPs, ports, and protocols.</p><h2 id="traffic-flow-architecture" tabindex="-1"><a class="header-anchor" href="#traffic-flow-architecture"><span>Traffic Flow Architecture</span></a></h2><p>Before diving into routing rules, it&#39;s crucial to understand that <strong>not all traffic automatically goes through Xray</strong>. The XRAYUI module implements a multi-layer traffic control system:</p><h3 id="layer-1-system-level-interception" tabindex="-1"><a class="header-anchor" href="#layer-1-system-level-interception"><span>Layer 1: System-Level Interception</span></a></h3><p>First, the router decides what traffic to intercept based on your basic configuration:</p><ul><li><strong><a class="route-link" href="/asuswrt-merlin-xrayui/en/br-policy">Bypass/Redirect Policies</a></strong> determine which devices and ports are handled</li><li><strong><a href="general-options#enable-dns-bypass-ipset">DNS Bypass Mode</a></strong> affects how domain-based decisions are made</li><li>Only intercepted traffic reaches Xray for processing</li></ul><h3 id="layer-2-dns-resolution-bypass" tabindex="-1"><a class="header-anchor" href="#layer-2-dns-resolution-bypass"><span>Layer 2: DNS Resolution &amp; Bypass</span></a></h3><p>Before Xray routing rules are evaluated, the <strong>DNS Bypass/Redirect</strong> feature can make routing decisions.</p><p>Initially, the module intercepts any traffic (well, almost any, but that&#39;s not important in this case) and redirects it to Xray&#39;s dokodemo inbound port. As it turned out, under heavy loads, Xray struggles to handle such traffic flow on weak routers.</p><h4 id="dns-bypass-modes" tabindex="-1"><a class="header-anchor" href="#dns-bypass-modes"><span>DNS Bypass Modes</span></a></h4><ul><li><p><strong>OFF</strong>: All intercepted traffic goes to Xray for rule-based routing</p></li><li><p><strong>BYPASS</strong>: Extracts all rules from the config that are specified with <code>FREEDOM</code> outbound type, and essentially any traffic to these domains won&#39;t be sent to Xray. For example, if you made a rule <code>domain:ru</code> to FREEDOM - this way any traffic to .ru domains won&#39;t be thrown to Xray, but will flow as if there&#39;s no Xray on the router at all. Other traffic goes through Xray.</p></li><li><p><strong>REDIRECT</strong>: Works opposite to bypass - extracts all rules where the outbound type is NOT FREEDOM and sends them to Xray. So if you made a rule <code>geosite:youtube</code> to proxy outbound, this way all traffic except YouTube domains will bypass Xray, and YouTube will be thrown to the Xray process.</p></li></ul><div class="hint-container important"><p class="hint-container-title">Important</p><p>DNS Bypass/Redirect happens BEFORE Xray routing rules! This is traffic routing even before it gets into the Xray process. It&#39;s important to remember that how and where your traffic goes inside Xray depends on your rules in Xray, but that&#39;s another story entirely.</p></div><div class="hint-container note"><p class="hint-container-title">Note</p><p>Important point: in geodata categories, you may occasionally (very rarely, but it happens) encounter <code>regexp:</code> prefixes for domains. Such &quot;domains&quot; are ignored by the &quot;enable DNS bypass&quot; option and won&#39;t work, but this is, let&#39;s say, a minor issue.</p></div><h3 id="layer-3-xray-routing-rules" tabindex="-1"><a class="header-anchor" href="#layer-3-xray-routing-rules"><span>Layer 3: Xray Routing Rules</span></a></h3><p>Only traffic that passes through the previous layers reaches Xray&#39;s routing engine, where your rules are evaluated sequentially.</p><h2 id="understanding-domain-prefixes" tabindex="-1"><a class="header-anchor" href="#understanding-domain-prefixes"><span>Understanding Domain Prefixes</span></a></h2><p>Domain routing in Xray provides flexible traffic management through various matching approaches. Understanding these prefixes is essential for effective rule creation.</p><h3 id="basic-domain-matching" tabindex="-1"><a class="header-anchor" href="#basic-domain-matching"><span>Basic Domain Matching</span></a></h3><p>The <code>domain:</code> prefix is the foundation of domain-based routing:</p><ul><li><p><strong><code>domain:com</code></strong> — Matches ALL .com top-level domains and their subdomains</p><ul><li>✅ Matches: <code>dmn.com</code>, <code>example.com</code>, <code>sub.example.com</code></li><li>❌ Doesn&#39;t match: <code>us.com</code>, <code>us-server.net</code></li></ul></li><li><p><strong><code>domain:dmn.com</code></strong> — Matches the domain and all its subdomains</p><ul><li>✅ Matches: <code>dmn.com</code>, <code>www.dmn.com</code>, <code>some.sub.domain.dmn.com</code></li><li>❌ Doesn&#39;t match: <code>domains.com</code>, <code>notdmn.com</code></li></ul></li><li><p><strong><code>domain:www.dmn.com</code></strong> — Matches only this specific subdomain and its sub-subdomains</p><ul><li>✅ Matches: <code>www.dmn.com</code>, <code>api.www.dmn.com</code></li><li>❌ Doesn&#39;t match: <code>dmn.com</code>, <code>m.dmn.com</code></li></ul></li></ul><h3 id="full-domain-matching" tabindex="-1"><a class="header-anchor" href="#full-domain-matching"><span>Full Domain Matching</span></a></h3><p>Use <code>full:</code> when you need exact domain matching without subdomains:</p><ul><li><strong><code>full:google.com</code></strong> — Matches ONLY <code>google.com</code><ul><li>✅ Matches: <code>google.com</code></li><li>❌ Doesn&#39;t match: <code>www.google.com</code>, <code>maps.google.com</code></li></ul></li></ul><h3 id="pattern-matching" tabindex="-1"><a class="header-anchor" href="#pattern-matching"><span>Pattern Matching</span></a></h3><p>For more flexible matching, use keyword and regex patterns:</p><ul><li><p><strong><code>keyword:google</code></strong> — Matches any domain containing &quot;google&quot;</p><ul><li>✅ Matches: <code>google.com</code>, <code>googleusercontent.com</code>, <code>mygooglesite.net</code></li></ul></li><li><p><strong><code>regexp:.*\.edu$</code></strong> — Matches domains ending with .edu using regular expressions</p><ul><li>✅ Matches: <code>harvard.edu</code>, <code>mit.edu</code></li><li>❌ Doesn&#39;t match: <code>education.com</code></li></ul></li></ul><h2 id="working-with-geosite-databases" tabindex="-1"><a class="header-anchor" href="#working-with-geosite-databases"><span>Working with Geosite Databases</span></a></h2><p>For managing large collections of domains efficiently, Xray supports geosite files. These are community-maintained databases that group hundreds or thousands of related domains under single tags.</p><h3 id="why-use-geosite" tabindex="-1"><a class="header-anchor" href="#why-use-geosite"><span>Why Use Geosite?</span></a></h3><p>Instead of manually listing dozens of domains for a service like YouTube:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">domain:youtube.com</span>
<span class="line">domain:youtube.ru</span>
<span class="line">domain:youtu.be</span>
<span class="line">domain:youtubeeducation.com</span>
<span class="line">domain:youtube-nocookie.com</span>
<span class="line">domain:googleapis.com</span>
<span class="line"># ... and many more</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>You can simply use:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">geosite:youtube</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This automatically includes ALL YouTube-related domains from the community database, including CDNs, API endpoints, and regional variants.</p><h3 id="available-geosite-categories" tabindex="-1"><a class="header-anchor" href="#available-geosite-categories"><span>Available Geosite Categories</span></a></h3><p>The community maintains extensive domain lists. You can find all available categories at: <a href="https://github.com/v2fly/domain-list-community/tree/master/data" target="_blank" rel="noopener noreferrer">GitHub: v2fly/domain-list-community</a></p><p>Common categories include:</p><ul><li><code>geosite:google</code> — All Google services</li><li><code>geosite:youtube</code> — YouTube and related domains</li><li><code>geosite:netflix</code> — Netflix streaming service</li><li><code>geosite:telegram</code> — Telegram messenger</li><li><code>geosite:facebook</code> — Facebook and Instagram</li><li><code>geosite:twitter</code> — Twitter/X platform</li><li><code>geosite:cn</code> — Chinese websites</li><li><code>geosite:category-media-ru</code> - All banned media in Russia</li><li><code>geosite:category-ads-all</code> — Advertisement networks</li><li><code>geosite:geolocation-!cn</code> — Non-Chinese sites</li></ul><h3 id="understanding-category-contents" tabindex="-1"><a class="header-anchor" href="#understanding-category-contents"><span>Understanding Category Contents</span></a></h3><p>Let&#39;s examine how categories work with a simple example:</p><p>The <code>geosite:actalis</code> category contains just two domains:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">domain:actalis.com</span>
<span class="line">domain:actalis.it</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>When you use <code>geosite:actalis</code>, it&#39;s equivalent to adding both domains manually. However, the key advantage is <strong>automatic updates</strong> — if the community adds new Actalis domains in the future, your rules automatically include them when you update the geosite database.</p><h3 id="community-contributions" tabindex="-1"><a class="header-anchor" href="#community-contributions"><span>Community Contributions</span></a></h3><p>The geosite database is community-driven. For example, the <code>category-media-ru</code> category was recently added:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">geosite:category-media-ru</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>This now automatically includes all category-media-ru-related domains without needing to list them individually.</p><h3 id="creating-custom-geosite-categories" tabindex="-1"><a class="header-anchor" href="#creating-custom-geosite-categories"><span>Creating Custom Geosite Categories</span></a></h3><p>You can create your own domain lists using xrayui&#39;s custom geosite feature: Read more about <a href="/en/custom-geodata" target="_blank" rel="noopener noreferrer">custom geosite dat files</a>.</p><h3 id="updating-geosite-databases" tabindex="-1"><a class="header-anchor" href="#updating-geosite-databases"><span>Updating Geosite Databases</span></a></h3><p>The community geosite databases are regularly updated with new domains and categories. To keep your routing accurate:</p><h4 id="manual-update" tabindex="-1"><a class="header-anchor" href="#manual-update"><span>Manual Update</span></a></h4><ol><li>Go to <strong>Routing</strong> section</li><li>Click <strong>Update community files</strong> button</li><li>Wait for the update to complete</li><li>Apply configuration</li></ol><h4 id="automatic-updates" tabindex="-1"><a class="header-anchor" href="#automatic-updates"><span>Automatic Updates</span></a></h4><ol><li>Go to <strong>General Options</strong> → <strong>Geodata</strong> tab</li><li>Enable <strong>Auto-update geodata files</strong></li><li>Updates will occur nightly at 03:00</li></ol><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>Regular updates ensure your rules catch newly added domains for services like streaming platforms that frequently add new CDN endpoints.</p></div><h3 id="verifying-geosite-contents" tabindex="-1"><a class="header-anchor" href="#verifying-geosite-contents"><span>Verifying Geosite Contents</span></a></h3><p>To see what domains are included in a geosite category:</p><ol><li>Check the <a href="https://github.com/v2fly/domain-list-community/tree/master/data" target="_blank" rel="noopener noreferrer">official repository</a></li><li>Search for the category file (e.g., <code>youtube</code>)</li><li>Review the included domains and patterns</li></ol><p>This helps you understand exactly what traffic your rules will match.</p><h2 id="understanding-routing-rules" tabindex="-1"><a class="header-anchor" href="#understanding-routing-rules"><span>Understanding Routing Rules</span></a></h2><p>In <code>XRAYUI</code>, routing rules work as a <strong>sequential decision tree</strong>. When traffic arrives, Xray evaluates rules from top to bottom and applies the <strong>first matching rule</strong>. If no rules match, traffic uses the default behavior.</p><div class="hint-container important"><p class="hint-container-title">Important</p><p>Rule order matters! Rules are evaluated sequentially, so more specific rules should generally come before broader ones.</p></div><h2 id="the-rules-interface" tabindex="-1"><a class="header-anchor" href="#the-rules-interface"><span>The Rules Interface</span></a></h2><p>To manage routing rules in <code>XRAYUI</code>:</p><ol><li>Navigate to the <strong>Routing</strong> section on the main page <img src="data:image/png;base64,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" alt=""></li><li>Click the <strong>Manage</strong> button next to <strong>Rules</strong></li><li>The Rules Manager window will open <img src="/asuswrt-merlin-xrayui/assets/20251025011756-CGbahTR7.png" alt=""></li></ol><h2 id="adding-a-new-rule" tabindex="-1"><a class="header-anchor" href="#adding-a-new-rule"><span>Adding a New Rule</span></a></h2><h3 id="step-1-open-the-rule-editor" tabindex="-1"><a class="header-anchor" href="#step-1-open-the-rule-editor"><span>Step 1: Open the Rule Editor</span></a></h3><p>Click <strong>Add new rule</strong> at the bottom of the Rules Manager window.</p><h3 id="step-2-configure-basic-settings" tabindex="-1"><a class="header-anchor" href="#step-2-configure-basic-settings"><span>Step 2: Configure Basic Settings</span></a></h3><table><thead><tr><th>Field</th><th>Description</th><th>Example</th></tr></thead><tbody><tr><td><strong>Friendly Name</strong></td><td>Optional descriptive name for your rule</td><td>&quot;Netflix to Proxy&quot;</td></tr><tr><td><strong>Outbound connection</strong></td><td>Which outbound to use when rule matches</td><td>proxy, direct, block</td></tr><tr><td><strong>Enabled</strong></td><td>Toggle rule on/off without deleting</td><td>✓ (checked)</td></tr></tbody></table><h3 id="step-3-define-matching-criteria" tabindex="-1"><a class="header-anchor" href="#step-3-define-matching-criteria"><span>Step 3: Define Matching Criteria</span></a></h3><p><img src="/asuswrt-merlin-xrayui/assets/20251025011905-BEKkoQCM.png" alt=""></p><p>Rules can match traffic based on multiple criteria:</p><h4 id="domains" tabindex="-1"><a class="header-anchor" href="#domains"><span>Domains</span></a></h4><p>Enter domains to match, one per line. Supports multiple formats:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># Exact domain and subdomains</span>
<span class="line">domain:google.com</span>
<span class="line"></span>
<span class="line"># Only exact match</span>
<span class="line">full:www.google.com</span>
<span class="line"></span>
<span class="line"># Keyword matching</span>
<span class="line">keyword:facebook</span>
<span class="line"></span>
<span class="line"># Regular expression</span>
<span class="line">regexp:.*\.gov$</span>
<span class="line"></span>
<span class="line"># Geosite databases</span>
<span class="line">geosite:netflix</span>
<span class="line">geosite:category-ads</span>
<span class="line">ext:xrayui:streaming</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>Use the <strong>geosite:</strong> and <strong>ext:xrayui:</strong> buttons above the domain field for quick prefix insertion. The autocomplete feature will help you find available tags.</p></div><h4 id="ip-addresses" tabindex="-1"><a class="header-anchor" href="#ip-addresses"><span>IP Addresses</span></a></h4><p>Specify IP addresses or ranges:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># Single IP</span>
<span class="line">1.1.1.1</span>
<span class="line"></span>
<span class="line"># CIDR notation</span>
<span class="line">192.168.1.0/24</span>
<span class="line"></span>
<span class="line"># IP range</span>
<span class="line">10.0.0.1-10.0.0.100</span>
<span class="line"></span>
<span class="line"># GeoIP database</span>
<span class="line">geoip:cn</span>
<span class="line">geoip:ru</span>
<span class="line">geoip:private</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ports" tabindex="-1"><a class="header-anchor" href="#ports"><span>Ports</span></a></h4><p>Define specific ports or ranges:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># Single port</span>
<span class="line">443</span>
<span class="line"></span>
<span class="line"># Port range (use colon)</span>
<span class="line">8080:8090</span>
<span class="line"></span>
<span class="line"># Multiple ports</span>
<span class="line">80,443,8080</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="source-ips" tabindex="-1"><a class="header-anchor" href="#source-ips"><span>Source IPs</span></a></h4><p>Match traffic from specific source IPs (useful for device-specific rules):</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">192.168.1.100</span>
<span class="line">192.168.1.0/24</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="protocols" tabindex="-1"><a class="header-anchor" href="#protocols"><span>Protocols</span></a></h4><p>Select protocols to match:</p><ul><li>HTTP</li><li>TLS (HTTPS)</li><li>BitTorrent</li></ul><h4 id="network-type" tabindex="-1"><a class="header-anchor" href="#network-type"><span>Network Type</span></a></h4><p>Choose the transport protocol:</p><ul><li>TCP</li><li>UDP</li><li>TCP,UDP (both)</li></ul><h4 id="inbound-tags" tabindex="-1"><a class="header-anchor" href="#inbound-tags"><span>Inbound Tags</span></a></h4><p>Match traffic from specific inbounds (useful when you have multiple entry points).</p><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>Remember the <strong>Golden Rule</strong>: If nothing is selected - everything is selected. it means you dont need to select everything to cover all. Just leave ithe field blank.</p></div><h3 id="step-4-save-the-rule" tabindex="-1"><a class="header-anchor" href="#step-4-save-the-rule"><span>Step 4: Save the Rule</span></a></h3><p>Click <strong>Save</strong> to add the rule to your configuration.</p><h2 id="practical-examples-dns-bypass-routing-rules" tabindex="-1"><a class="header-anchor" href="#practical-examples-dns-bypass-routing-rules"><span>Practical Examples: DNS Bypass + Routing Rules</span></a></h2><p>Understanding how DNS Bypass and routing rules interact is crucial for proper configuration. Here are real-world scenarios:</p><h3 id="scenario-1-performance-optimization" tabindex="-1"><a class="header-anchor" href="#scenario-1-performance-optimization"><span>Scenario 1: Performance Optimization</span></a></h3><p><strong>Goal</strong>: Proxy only blocked services, everything else direct</p><p><strong>Configuration</strong>:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">DNS B/R Option</span><span class="token punctuation">:</span> REDIRECT mode</span>
<span class="line"><span class="token key atrule">B/R Policy</span><span class="token punctuation">:</span> Redirect ports 80<span class="token punctuation">,</span><span class="token number">443</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">Routing Rules</span><span class="token punctuation">:</span></span>
<span class="line">1. YouTube → geosite<span class="token punctuation">:</span>youtube → proxy</span>
<span class="line">2. Netflix → geosite<span class="token punctuation">:</span>netflix → proxy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Result</strong>: Only YouTube and Netflix go through Xray. All other traffic bypasses Xray entirely at the DNS/IPSET level, reducing CPU load.</p><h3 id="scenario-2-maximum-control" tabindex="-1"><a class="header-anchor" href="#scenario-2-maximum-control"><span>Scenario 2: Maximum Control</span></a></h3><p><strong>Goal</strong>: Complex routing with different proxies for different services</p><p><strong>Configuration</strong>:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">DNS Bypass</span><span class="token punctuation">:</span> OFF</span>
<span class="line"><span class="token key atrule">B/R Policy</span><span class="token punctuation">:</span> all to xray</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">Routing Rules</span><span class="token punctuation">:</span></span>
<span class="line">1. Work traffic → domain<span class="token punctuation">:</span>company.com → work<span class="token punctuation">-</span>proxy</span>
<span class="line">2. Streaming → geosite<span class="token punctuation">:</span>netflix → us<span class="token punctuation">-</span>proxy</span>
<span class="line">3. Social Media → geosite<span class="token punctuation">:</span>twitter → europe<span class="token punctuation">-</span>proxy</span>
<span class="line">4. Gaming → ports<span class="token punctuation">:</span>27000<span class="token punctuation">-</span>27100 → direct</span>
<span class="line">5. Default → * → smart<span class="token punctuation">-</span>proxy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Result</strong>: All traffic goes through Xray for evaluation, allowing sophisticated routing decisions.</p><h3 id="scenario-3-device-specific-with-bypass" tabindex="-1"><a class="header-anchor" href="#scenario-3-device-specific-with-bypass"><span>Scenario 3: Device-Specific with Bypass</span></a></h3><p><strong>Goal</strong>: Smart TV direct, other devices proxied</p><p><strong>Configuration</strong>:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">DNS Bypass</span><span class="token punctuation">:</span> BYPASS mode</span>
<span class="line"><span class="token key atrule">B/R Policy</span><span class="token punctuation">:</span></span>
<span class="line">  <span class="token punctuation">-</span> Bypass MAC<span class="token punctuation">:</span>AA<span class="token punctuation">:</span>BB<span class="token punctuation">:</span>CC<span class="token punctuation">:</span>DD<span class="token punctuation">:</span>EE<span class="token punctuation">:</span>FF (Smart TV)</span>
<span class="line">  <span class="token punctuation">-</span> Redirect others on ports 80<span class="token punctuation">,</span><span class="token number">443</span></span>
<span class="line"></span>
<span class="line"><span class="token key atrule">Routing Rules</span><span class="token punctuation">:</span></span>
<span class="line">1. Local network → geoip<span class="token punctuation">:</span>private → direct</span>
<span class="line">2. Blocked sites → geosite<span class="token punctuation">:</span>netflix → proxy</span>
<span class="line">3. Default → * → proxy</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>Result</strong>: Smart TV never reaches Xray. Other devices have Netflix proxied, rest goes direct via DNS bypass.</p><h2 id="rule-priority-and-ordering" tabindex="-1"><a class="header-anchor" href="#rule-priority-and-ordering"><span>Rule Priority and Ordering</span></a></h2><p>Rules are processed in order from top to bottom. Here&#39;s the recommended priority order:</p><ol><li><strong>System rules</strong> (xrayui auto-generated, usually at the top, start with prefix <code>sys:</code>)</li><li><strong>Blocking rules</strong> (ads, malware, trackers)</li><li><strong>Device-specific rules</strong> (by source IP/MAC)</li><li><strong>Service-specific rules</strong> (streaming, gaming)</li><li><strong>Port-based rules</strong> (specific applications)</li><li><strong>Geographic rules</strong> (country-based routing)</li><li><strong>Catch-all rules</strong> (default behavior)</li></ol><div class="hint-container tip"><p class="hint-container-title">Tips</p><p>Use the drag handle (⋮⋮) on the left of each rule to reorder them. The visual order in the list represents the actual evaluation order.</p></div><h3 id="interaction-with-dns-bypass" tabindex="-1"><a class="header-anchor" href="#interaction-with-dns-bypass"><span>Interaction with DNS Bypass</span></a></h3><p>Remember that DNS Bypass mode affects which traffic reaches your rules:</p><p><strong>In BYPASS mode:</strong></p><ul><li>Domains matching rules with <code>FREEDOM</code> outbound never reach Xray</li><li>Only non-FREEDOM domains are evaluated by routing rules</li><li>This improves performance but reduces control</li></ul><p><strong>In REDIRECT mode:</strong></p><ul><li>Only domains NOT matching FREEDOM rules go through Xray</li><li>Inverse logic of BYPASS mode</li><li>Useful when most traffic should be direct</li></ul><p><strong>With DNS Bypass OFF:</strong></p><ul><li>All intercepted traffic reaches Xray routing rules</li><li>Maximum control but higher resource usage</li><li>Recommended for complex routing scenarios</li></ul><div class="hint-container warning"><p class="hint-container-title">Warning</p><p>If using DNS Bypass, ensure your FREEDOM rules in Xray align with your bypass intentions. Misalignment can cause unexpected routing behavior.</p></div><h2 id="working-with-geosite-geoip" tabindex="-1"><a class="header-anchor" href="#working-with-geosite-geoip"><span>Working with Geosite/GeoIP</span></a></h2><h3 id="using-built-in-databases" tabindex="-1"><a class="header-anchor" href="#using-built-in-databases"><span>Using Built-in Databases</span></a></h3><p><strong>XRAYUI</strong> includes community-maintained geographic databases:</p><p><strong>Common Geosite Tags:</strong></p><ul><li><code>geosite:google</code> - All Google services</li><li><code>geosite:facebook</code> - Facebook and subsidiaries</li><li><code>geosite:netflix</code> - Netflix domains</li><li><code>geosite:telegram</code> - Telegram messenger</li><li><code>geosite:cn</code> - Chinese websites</li><li><code>geosite:category-ads-all</code> - Advertisement domains</li></ul><p><strong>Common GeoIP Tags:</strong></p><ul><li><code>geoip:cn</code> - Chinese IP addresses</li><li><code>geoip:us</code> - US IP addresses</li><li><code>geoip:private</code> - Private/LAN addresses</li><li><code>geoip:cloudflare</code> - Cloudflare IPs</li></ul><h3 id="custom-geosite-files" tabindex="-1"><a class="header-anchor" href="#custom-geosite-files"><span>Custom Geosite Files</span></a></h3><p>You can create custom domain lists. See <a href="custom-geodata">Custom Geosite Files</a> for details.</p><h2 id="advanced-features" tabindex="-1"><a class="header-anchor" href="#advanced-features"><span>Advanced Features</span></a></h2><h3 id="domain-matching-strategies" tabindex="-1"><a class="header-anchor" href="#domain-matching-strategies"><span>Domain Matching Strategies</span></a></h3><p>Set the <strong>Domain Matcher</strong> to optimize performance:</p><ul><li><strong>hybrid</strong> (default): Balanced performance and accuracy</li><li><strong>linear</strong>: Sequential matching, more accurate but slower</li></ul><p><img src="/asuswrt-merlin-xrayui/assets/20251025013437-CXUmHJ-f.png" alt=""></p><h3 id="using-multiple-criteria" tabindex="-1"><a class="header-anchor" href="#using-multiple-criteria"><span>Using Multiple Criteria</span></a></h3><p>Rules with multiple criteria use AND logic. The rule matches only when <strong>ALL</strong> specified conditions are met:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token comment"># This rule matches HTTPS traffic from 192.168.1.100</span></span>
<span class="line"><span class="token key atrule">Domains</span><span class="token punctuation">:</span> domain<span class="token punctuation">:</span>example.com</span>
<span class="line"><span class="token key atrule">Source IPs</span><span class="token punctuation">:</span> 192.168.1.100</span>
<span class="line"><span class="token key atrule">Ports</span><span class="token punctuation">:</span> <span class="token number">443</span></span>
<span class="line"><span class="token comment"># ALL three conditions must be true for a match</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="temporary-rule-disabling" tabindex="-1"><a class="header-anchor" href="#temporary-rule-disabling"><span>Temporary Rule Disabling</span></a></h3><p>Instead of deleting rules, you can temporarily disable them:</p><ol><li>Uncheck the checkbox next to the rule name</li><li>The rule moves to the &quot;disabled&quot; section but retains its configuration</li><li>Re-enable when needed without reconfiguration</li></ol><h2 id="best-practices" tabindex="-1"><a class="header-anchor" href="#best-practices"><span>Best Practices</span></a></h2><h3 id="_1-start-specific-then-generalize" tabindex="-1"><a class="header-anchor" href="#_1-start-specific-then-generalize"><span>1. Start Specific, Then Generalize</span></a></h3><p>Begin with specific rules for critical services, then add broader catch-all rules.</p><h3 id="_2-use-descriptive-names" tabindex="-1"><a class="header-anchor" href="#_2-use-descriptive-names"><span>2. Use Descriptive Names</span></a></h3><p>Give rules meaningful names that describe their purpose:</p><ul><li>✅ &quot;Netflix to Proxy&quot;</li><li>❌ &quot;Rule 1&quot;</li></ul><h3 id="_3-group-related-rules" tabindex="-1"><a class="header-anchor" href="#_3-group-related-rules"><span>3. Group Related Rules</span></a></h3><p>Keep similar rules together for easier management:</p><ul><li>Group all streaming rules</li><li>Group all blocking rules</li><li>Group all device-specific rules</li></ul><h3 id="_4-test-before-deploying" tabindex="-1"><a class="header-anchor" href="#_4-test-before-deploying"><span>4. Test Before Deploying</span></a></h3><ol><li>Add new rules as disabled</li><li>Enable and test individually</li><li>Monitor logs for unexpected behavior</li><li>Adjust as needed</li></ol><h3 id="_5-regular-maintenance" tabindex="-1"><a class="header-anchor" href="#_5-regular-maintenance"><span>5. Regular Maintenance</span></a></h3><ul><li>Review rules periodically</li><li>Remove obsolete rules</li><li>Update geosite/geoip databases regularly</li><li>Consolidate similar rules when possible</li></ul><h3 id="_6-document-complex-rules" tabindex="-1"><a class="header-anchor" href="#_6-document-complex-rules"><span>6. Document Complex Rules</span></a></h3><p>For complex regex or multi-condition rules, add clear names and consider keeping external documentation.</p><h2 id="troubleshooting" tabindex="-1"><a class="header-anchor" href="#troubleshooting"><span>Troubleshooting</span></a></h2><h3 id="rules-not-working" tabindex="-1"><a class="header-anchor" href="#rules-not-working"><span>Rules Not Working</span></a></h3><ol><li><p><strong>Check DNS Bypass mode</strong> - Your rules might not be reached due to DNS bypass</p><ul><li>If using BYPASS/REDIRECT, verify domains aren&#39;t being handled before Xray</li><li>Try temporarily disabling DNS bypass to isolate the issue</li></ul></li><li><p><strong>Verify B/R Policies</strong> - Traffic might not be intercepted at all</p><ul><li>Check if the device/port is set to redirect to Xray</li><li>Verify MAC addresses and port ranges</li></ul></li><li><p><strong>Check rule order</strong> - More specific rules must come before general ones</p></li><li><p><strong>Verify outbound tags</strong> - Ensure the specified outbound exists</p></li><li><p><strong>Check syntax</strong> - Validate domain/IP formats</p><ul><li>Remember: <code>domain:</code> not <code>domain.</code></li><li>Use <code>geosite:</code> not <code>geosite.</code></li></ul></li><li><p><strong>Review logs</strong> - Enable logs to see which rules are matching</p></li></ol><h3 id="traffic-not-going-through-proxy" tabindex="-1"><a class="header-anchor" href="#traffic-not-going-through-proxy"><span>Traffic Not Going Through Proxy</span></a></h3><p><strong>Symptom</strong>: Sites load but aren&#39;t proxied despite having rules</p><p><strong>Common causes</strong>:</p><ol><li><strong>DNS Bypass is ON</strong> with REDIRECT mode and domain matches FREEDOM</li><li><strong>B/R Policy</strong> doesn&#39;t include the ports being used</li><li><strong>DNS resolution</strong> happening before proxy (check DNS leak prevention)</li><li><strong>QUIC/HTTP3</strong> traffic on UDP 443 not being intercepted</li></ol><p><strong>Solution steps</strong>:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">1</span>. Set DNS Bypass to OFF temporarily</span>
<span class="line"><span class="token number">2</span>. Ensure B/R Policy includes both TCP and UDP</span>
<span class="line"><span class="token number">3</span>. Add UDP port <span class="token number">443</span> to your redirect policy</span>
<span class="line"><span class="token number">4</span>. Check logs to verify traffic reaches Xray</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="unexpected-direct-connections" tabindex="-1"><a class="header-anchor" href="#unexpected-direct-connections"><span>Unexpected Direct Connections</span></a></h3><p><strong>Symptom</strong>: Some traffic bypasses proxy without matching any direct rule</p><p><strong>Check</strong>:</p><ol><li><strong>ipset rules</strong> from DNS bypass creating kernel-level bypasses</li><li><strong>System DNS</strong> queries not being intercepted</li><li><strong>IPv6 traffic</strong> if not properly handled</li><li><strong>Cached DNS</strong> responses from before configuration change</li></ol><h3 id="performance-issues" tabindex="-1"><a class="header-anchor" href="#performance-issues"><span>Performance Issues</span></a></h3><p>If routing is slow:</p><ol><li>Reduce regex usage (most resource-intensive)</li><li>Consolidate similar rules</li><li>Use geosite tags instead of listing many domains</li><li>Switch domain matcher to &quot;linear&quot; if accuracy is more important than speed</li></ol><h3 id="debugging-rules" tabindex="-1"><a class="header-anchor" href="#debugging-rules"><span>Debugging Rules</span></a></h3><p>Enable logging to see rule matches:</p><ol><li>Go to <strong>General Options</strong> → <strong>Logs</strong></li><li>Enable <strong>Access logs</strong></li><li>Set <strong>Log level</strong> to &quot;info&quot; or &quot;debug&quot;</li><li>Check logs to see which rules are triggered</li></ol><h3 id="common-mistakes-to-avoid" tabindex="-1"><a class="header-anchor" href="#common-mistakes-to-avoid"><span>Common Mistakes to Avoid</span></a></h3><ul><li><strong>Wrong prefix format</strong>: Use <code>domain:</code> not <code>domain.</code></li><li><strong>Port format confusion</strong>: Use <code>:</code> for ranges (8080:8090), not <code>-</code></li><li><strong>Missing network type</strong>: Specify tcp, udp, or both</li><li><strong>Incorrect rule order</strong>: Catch-all rules placed too early</li><li><strong>Conflicting rules</strong>: Multiple rules matching the same traffic</li></ul><h2 id="quick-reference" tabindex="-1"><a class="header-anchor" href="#quick-reference"><span>Quick Reference</span></a></h2><h3 id="domain-prefixes" tabindex="-1"><a class="header-anchor" href="#domain-prefixes"><span>Domain Prefixes</span></a></h3><table><thead><tr><th>Prefix</th><th>Matches</th><th>Example</th></tr></thead><tbody><tr><td><code>domain:</code></td><td>Domain and all subdomains</td><td><code>domain:google.com</code> matches <code>maps.google.com</code></td></tr><tr><td><code>full:</code></td><td>Exact domain only</td><td><code>full:google.com</code> matches only <code>google.com</code></td></tr><tr><td><code>keyword:</code></td><td>Contains keyword</td><td><code>keyword:google</code> matches <code>googleplex.com</code></td></tr><tr><td><code>regexp:</code></td><td>Regular expression</td><td><code>regexp:.*\.edu$</code> matches <code>.edu</code> domains</td></tr><tr><td><code>geosite:</code></td><td>Geosite database</td><td><code>geosite:netflix</code></td></tr><tr><td><code>ext:xrayui:</code></td><td>Custom xrayui lists</td><td><code>ext:xrayui:mylist</code></td></tr></tbody></table><h2 id="configuration-decision-tree" tabindex="-1"><a class="header-anchor" href="#configuration-decision-tree"><span>Configuration Decision Tree</span></a></h2><p>When setting up routing in xrayui, follow this decision tree:</p><div class="language-plain line-numbers-mode" data-highlighter="prismjs" data-ext="plain"><pre><code class="language-plain"><span class="line">1. How much traffic needs proxying?</span>
<span class="line">   ├─ Most traffic → DNS Bypass OFF</span>
<span class="line">   └─ Selective → DNS Bypass ON</span>
<span class="line">       ├─ Proxy specific sites → REDIRECT mode</span>
<span class="line">       └─ Bypass specific sites → BYPASS mode</span>
<span class="line"></span>
<span class="line">2. Which devices need proxying?</span>
<span class="line">   ├─ All devices → B/R Policy: Redirect all</span>
<span class="line">   └─ Specific devices → B/R Policy: By MAC/IP</span>
<span class="line"></span>
<span class="line">3. What ports to intercept?</span>
<span class="line">   ├─ Web only → TCP/UDP 80,443</span>
<span class="line">   ├─ All traffic → All ports</span>
<span class="line">   └─ Custom apps → Specific port ranges</span>
<span class="line"></span>
<span class="line">4. How complex is routing?</span>
<span class="line">   ├─ Simple (proxy/direct) → Basic rules</span>
<span class="line">   ├─ By service → Use geosite categories</span>
<span class="line">   └─ Complex logic → Multiple rule layers</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="summary" tabindex="-1"><a class="header-anchor" href="#summary"><span>Summary</span></a></h2><p>Effective routing in xrayui requires understanding three layers:</p><h3 id="layer-1-b-r-policies" tabindex="-1"><a class="header-anchor" href="#layer-1-b-r-policies"><span>Layer 1: B/R Policies</span></a></h3><p>Controls which devices and ports are intercepted by the system.</p><h3 id="layer-2-dns-bypass" tabindex="-1"><a class="header-anchor" href="#layer-2-dns-bypass"><span>Layer 2: DNS Bypass</span></a></h3><p>Pre-filters traffic before Xray, improving performance but reducing control.</p><h3 id="layer-3-xray-routing-rules-1" tabindex="-1"><a class="header-anchor" href="#layer-3-xray-routing-rules-1"><span>Layer 3: Xray Routing Rules</span></a></h3><p>Fine-grained control over traffic that reaches Xray.</p><p><strong>Key concepts to remember:</strong></p><ul><li>Not all traffic automatically goes through Xray</li><li>DNS Bypass can prevent rules from being evaluated</li><li>Rule order matters (first match wins)</li><li>Geosite categories simplify domain management</li><li>Different domain prefixes serve different purposes</li><li>Performance and control are often trade-offs</li></ul><p><strong>Best practices:</strong></p><ol><li>Start with DNS Bypass OFF to understand traffic flow</li><li>Use geosite categories instead of listing individual domains</li><li>Test rules incrementally</li><li>Monitor logs during initial setup</li><li>Optimize with DNS Bypass once routing works correctly</li><li>Document complex configurations</li></ol><div class="hint-container note"><p class="hint-container-title">Note</p><p>Remember to click <strong>Apply</strong> on the main page after making any configuration changes to activate your new routing setup.</p></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Last Updated: </span><time class="meta-item-info" datetime="2025-10-25T00:05:18.000Z" data-allow-mismatch>10/25/25, 12:05 AM</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: lavrushin@gmail.com">Daniel Lavrushin</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/asuswrt-merlin-xrayui/en/interface" aria-label="Interface Overview"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">Interface Overview</span></div><!--]--></a><a class="route-link auto-link next" href="/asuswrt-merlin-xrayui/en/general-options" aria-label="General Options"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">General Options</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/asuswrt-merlin-xrayui/assets/app-eTybrgsj.js" defer></script>
  </body>
</html>
