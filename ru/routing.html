<!doctype html>
<html lang="ru-RU">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Руководство по правилам маршрутизации | XrayUI</title><meta name="description" content="">
    <link rel="preload" href="/asuswrt-merlin-xrayui/assets/style-KwXFwar5.css" as="style"><link rel="stylesheet" href="/asuswrt-merlin-xrayui/assets/style-KwXFwar5.css">
    <link rel="modulepreload" href="/asuswrt-merlin-xrayui/assets/app-eTybrgsj.js"><link rel="modulepreload" href="/asuswrt-merlin-xrayui/assets/routing.html-BVi6wY0Z.js"><link rel="modulepreload" href="/asuswrt-merlin-xrayui/assets/20251025013437-C6_y1YdW.js">
    <link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/index.html-ZL0zZxfL.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/b4sni.html-Ba3o12Ck.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/br-policy.html-C-4UgqTA.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/changelog.html-CKPX_XYB.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/cli.html-Dqe7zj4l.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/custom-geodata.html-USELws9i.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/dns-leak.html-_hjwJI3_.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/general-options.html-DlpELEzm.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/import-config.html-_P18D6km.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/install.html-C42kObjO.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/interface.html-DcAHGYjV.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/routing.html-CMUZd7BC.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/rtls-scanner.html-BTaMzcn2.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/share-config.html-CwlwcHw_.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/subscriptions.html-BZ6vrsbx.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/tproxy.html-K22hdfAS.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/v2dat.html-1iHror3G.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/b4sni.html-BixeTGKS.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/br-policy.html-DIrOI7N7.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/changelog.html-Cb6G9TzF.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/cli.html-HzOqq1hm.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/custom-geodata.html-QDGiGKSh.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/dns-leak.html-bisDTiaZ.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/general-options.html-BZiDNEGz.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/import-config.html-CM88-Y8F.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/index.html-C2vSMad_.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/install.html-B-I2-Ks-.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/interface.html-CNiu5LVc.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/rtls-scanner.html-j_0TSXr8.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/share-config.html-tq5eAy9L.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/subscriptions.html-D72aw0Ef.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/tproxy.html-DCXOnUpY.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/v2dat.html-1Jijv1yf.js" as="script"><link rel="prefetch" href="/asuswrt-merlin-xrayui/assets/404.html-D8InpyWK.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/asuswrt-merlin-xrayui/ru/"><img class="vp-site-logo" src="/asuswrt-merlin-xrayui/images/logo.png" alt="XrayUI"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">XrayUI</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Руководства"><span class="title">Руководства</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Руководства"><span class="title">Руководства</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/install" aria-label="Как установить"><!--[--><!--[--><!--]--><!--]-->Как установить<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/interface" aria-label="Обзор интерфейса"><!--[--><!--[--><!--]--><!--]-->Обзор интерфейса<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/asuswrt-merlin-xrayui/ru/routing" aria-label="Руководство по правилам маршрутизации"><!--[--><!--[--><!--]--><!--]-->Руководство по правилам маршрутизации<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/general-options" aria-label="Общие параметры"><!--[--><!--[--><!--]--><!--]-->Общие параметры<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/import-config" aria-label="Импорт конфигурации"><!--[--><!--[--><!--]--><!--]-->Импорт конфигурации<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/br-policy" aria-label="Политика обхода/перенаправления"><!--[--><!--[--><!--]--><!--]-->Политика обхода/перенаправления<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/subscriptions" aria-label="Управление подписками"><!--[--><!--[--><!--]--><!--]-->Управление подписками<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/dns-leak" aria-label="Утечки DNS и как их избежать"><!--[--><!--[--><!--]--><!--]-->Утечки DNS и как их избежать<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/share-config" aria-label="Безопасный обмен конфигом"><!--[--><!--[--><!--]--><!--]-->Безопасный обмен конфигом<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/tproxy" aria-label="Прозрачный прокси (TPROXY)"><!--[--><!--[--><!--]--><!--]-->Прозрачный прокси (TPROXY)<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/rtls-scanner" aria-label="Сканер Reality TLS"><!--[--><!--[--><!--]--><!--]-->Сканер Reality TLS<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/custom-geodata" aria-label="Пользовательские файлы геоданных"><!--[--><!--[--><!--]--><!--]-->Пользовательские файлы геоданных<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/v2dat" aria-label="Инспекция баз данных Geosite и GeoIP"><!--[--><!--[--><!--]--><!--]-->Инспекция баз данных Geosite и GeoIP<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/b4sni" aria-label="B4SNI: Инспекция SNI"><!--[--><!--[--><!--]--><!--]-->B4SNI: Инспекция SNI<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/cli" aria-label="Команды (CLI)"><!--[--><!--[--><!--]--><!--]-->Команды (CLI)<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/changelog" aria-label="Список изменений"><!--[--><!--[--><!--]--><!--]-->Список изменений<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/" aria-label="English"><!--[--><!--[--><!--]--><!--]-->English<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/asuswrt-merlin-xrayui/ru/routing" aria-label="Russian"><!--[--><!--[--><!--]--><!--]-->Russian<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><!----></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Руководства"><span class="title">Руководства</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Руководства"><span class="title">Руководства</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/install" aria-label="Как установить"><!--[--><!--[--><!--]--><!--]-->Как установить<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/interface" aria-label="Обзор интерфейса"><!--[--><!--[--><!--]--><!--]-->Обзор интерфейса<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/asuswrt-merlin-xrayui/ru/routing" aria-label="Руководство по правилам маршрутизации"><!--[--><!--[--><!--]--><!--]-->Руководство по правилам маршрутизации<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/general-options" aria-label="Общие параметры"><!--[--><!--[--><!--]--><!--]-->Общие параметры<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/import-config" aria-label="Импорт конфигурации"><!--[--><!--[--><!--]--><!--]-->Импорт конфигурации<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/br-policy" aria-label="Политика обхода/перенаправления"><!--[--><!--[--><!--]--><!--]-->Политика обхода/перенаправления<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/subscriptions" aria-label="Управление подписками"><!--[--><!--[--><!--]--><!--]-->Управление подписками<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/dns-leak" aria-label="Утечки DNS и как их избежать"><!--[--><!--[--><!--]--><!--]-->Утечки DNS и как их избежать<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/share-config" aria-label="Безопасный обмен конфигом"><!--[--><!--[--><!--]--><!--]-->Безопасный обмен конфигом<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/tproxy" aria-label="Прозрачный прокси (TPROXY)"><!--[--><!--[--><!--]--><!--]-->Прозрачный прокси (TPROXY)<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/rtls-scanner" aria-label="Сканер Reality TLS"><!--[--><!--[--><!--]--><!--]-->Сканер Reality TLS<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/custom-geodata" aria-label="Пользовательские файлы геоданных"><!--[--><!--[--><!--]--><!--]-->Пользовательские файлы геоданных<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/v2dat" aria-label="Инспекция баз данных Geosite и GeoIP"><!--[--><!--[--><!--]--><!--]-->Инспекция баз данных Geosite и GeoIP<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/b4sni" aria-label="B4SNI: Инспекция SNI"><!--[--><!--[--><!--]--><!--]-->B4SNI: Инспекция SNI<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/cli" aria-label="Команды (CLI)"><!--[--><!--[--><!--]--><!--]-->Команды (CLI)<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/ru/changelog" aria-label="Список изменений"><!--[--><!--[--><!--]--><!--]-->Список изменений<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="Select language"><span class="title">Languages</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="Select language"><span class="title">Languages</span><span class="right arrow"></span></button><ul class="vp-navbar-dropdown" style="display:none;"><!--[--><li class="vp-navbar-dropdown-item"><a class="route-link auto-link" href="/asuswrt-merlin-xrayui/" aria-label="English"><!--[--><!--[--><!--]--><!--]-->English<!--[--><!--[--><!--]--><!--]--></a></li><li class="vp-navbar-dropdown-item"><a class="route-link route-link-active auto-link" href="/asuswrt-merlin-xrayui/ru/routing" aria-label="Russian"><!--[--><!--[--><!--]--><!--]-->Russian<!--[--><!--[--><!--]--><!--]--></a></li><!--]--></ul></div></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active">Руководства <!----></p><ul style="" class="vp-sidebar-children"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/ru/install" aria-label="Как установить"><!--[--><!--[--><!--]--><!--]-->Как установить<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/ru/interface" aria-label="Обзор интерфейса"><!--[--><!--[--><!--]--><!--]-->Обзор интерфейса<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/asuswrt-merlin-xrayui/ru/routing" aria-label="Руководство по правилам маршрутизации"><!--[--><!--[--><!--]--><!--]-->Руководство по правилам маршрутизации<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/ru/general-options" aria-label="Общие параметры"><!--[--><!--[--><!--]--><!--]-->Общие параметры<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/ru/import-config" aria-label="Импорт конфигурации"><!--[--><!--[--><!--]--><!--]-->Импорт конфигурации<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/ru/br-policy" aria-label="Политика обхода/перенаправления"><!--[--><!--[--><!--]--><!--]-->Политика обхода/перенаправления<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/ru/subscriptions" aria-label="Управление подписками"><!--[--><!--[--><!--]--><!--]-->Управление подписками<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/ru/dns-leak" aria-label="Утечки DNS и как их избежать"><!--[--><!--[--><!--]--><!--]-->Утечки DNS и как их избежать<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/ru/share-config" aria-label="Безопасный обмен конфигом"><!--[--><!--[--><!--]--><!--]-->Безопасный обмен конфигом<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/ru/tproxy" aria-label="Прозрачный прокси (TPROXY)"><!--[--><!--[--><!--]--><!--]-->Прозрачный прокси (TPROXY)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/ru/rtls-scanner" aria-label="Сканер Reality TLS"><!--[--><!--[--><!--]--><!--]-->Сканер Reality TLS<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/ru/custom-geodata" aria-label="Пользовательские файлы геоданных"><!--[--><!--[--><!--]--><!--]-->Пользовательские файлы геоданных<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/ru/v2dat" aria-label="Инспекция баз данных Geosite и GeoIP"><!--[--><!--[--><!--]--><!--]-->Инспекция баз данных Geosite и GeoIP<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item" href="/asuswrt-merlin-xrayui/ru/b4sni" aria-label="B4SNI: Инспекция SNI"><!--[--><!--[--><!--]--><!--]-->B4SNI: Инспекция SNI<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/asuswrt-merlin-xrayui/ru/cli" aria-label="Команды (CLI)"><!--[--><!--[--><!--]--><!--]-->Команды (CLI)<!--[--><!--[--><!--]--><!--]--></a><!----></li><li><a class="route-link auto-link vp-sidebar-item vp-sidebar-heading" href="/asuswrt-merlin-xrayui/ru/changelog" aria-label="Changelog"><!--[--><!--[--><!--]--><!--]-->Changelog<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="руководство-по-правилам-маршрутизации" tabindex="-1"><a class="header-anchor" href="#руководство-по-правилам-маршрутизации"><span>Руководство по правилам маршрутизации</span></a></h1><p>Правила маршрутизации являются ядром системы управления трафиком Xray. Они определяют, какое исходящее соединение (исходящий прокси (<code>vless</code>/<code>vmess</code>/<code>xhttp</code> и т.д.), прямое соединение (<code>freedom</code>) или блокировка (<code>blackhole</code>)) должно обрабатывать конкретный трафик на основе различных критериев, таких как домены, IP-адреса, порты и протоколы.</p><h2 id="архитектура-потока-трафика" tabindex="-1"><a class="header-anchor" href="#архитектура-потока-трафика"><span>Архитектура потока трафика</span></a></h2><p>Прежде чем погружаться в правила маршрутизации, крайне важно понимать, что <strong>не весь трафик автоматически проходит через Xray</strong>. Модуль XRAYUI реализует многоуровневую систему управления трафиком:</p><h3 id="уровень-1-перехват-на-системном-уровне" tabindex="-1"><a class="header-anchor" href="#уровень-1-перехват-на-системном-уровне"><span>Уровень 1: Перехват на системном уровне</span></a></h3><p>Сначала роутер решает, какой трафик перехватывать, основываясь на вашей базовой конфигурации:</p><ul><li><strong><a class="route-link" href="/asuswrt-merlin-xrayui/ru/br-policy">Политики обхода/перенаправления</a></strong> определяют, какие устройства и порты обрабатываются</li><li><strong><a href="general-options#%D0%B2%D0%BA%D0%BB%D1%8E%D1%87%D0%B8%D1%82%D1%8C-dns-%D0%BE%D0%B1%D1%85%D0%BE%D0%B4-ipset">Режим DNS обхода</a></strong> влияет на принятие решений на основе доменов</li><li>Только перехваченный трафик достигает Xray для обработки</li></ul><h3 id="уровень-2-разрешение-dns-и-обход" tabindex="-1"><a class="header-anchor" href="#уровень-2-разрешение-dns-и-обход"><span>Уровень 2: Разрешение DNS и обход</span></a></h3><p>Перед оценкой правил маршрутизации Xray функция <strong>DNS обхода/перенаправления</strong> может принимать решения о маршрутизации.</p><p>Изначально модуль отлавливает любой трафик (ну почти, но это не важно в данном случае) и перенаправляет на инбаунд порт докодемо иксрея. Как позже выяснилось, при больших нагрузках иксрею тяжко в немощных роутерах справляться с таким потоком.</p><h4 id="режимы-dns-обхода" tabindex="-1"><a class="header-anchor" href="#режимы-dns-обхода"><span>Режимы DNS обхода</span></a></h4><ul><li><p><strong>OFF</strong>: Весь перехваченный трафик идёт в Xray для маршрутизации на основе правил</p></li><li><p><strong>BYPASS</strong>: Вычленяет все правила из конфига, что указаны в тип аутбаунда <code>FREEDOM</code> и по сути любой трафик на эти домены не будет отправляться в иксрей. Например, если вы сделали правило <code>domain:ru</code> в FREEDOM - таким образом любой трафик на домены .ru не будет кидаться в иксрей, а будет ходить будто и нет никакого иксрея на роутере. Остальной трафик проходит через Xray.</p></li><li><p><strong>REDIRECT</strong>: Работает обратно байпассу - вычленяет все правила, где тип аутбаунда НЕ FREEDOM и шлет их в иксрей. То есть если вы сделали правило <code>geosite:youtube</code> в аутбаунд proxy, таким образом весь трафик кроме доменов ютуба будет обходить иксрей, а ютуб будет кидаться в иксрей процесс.</p></li></ul><div class="hint-container important"><p class="hint-container-title">Важно</p><p>DNS обход/перенаправление происходит ДО правил маршрутизации Xray! Это маршрутизация трафиком еще до того, как он попадет в процесс иксрея. Важно помнить, что то как и куда там внутри иксрея у вас идет трафик зависит от ваших правил в иксрее, но это скажем так уже другая история.</p></div><div class="hint-container note"><p class="hint-container-title">Заметка</p><p>Важный момент: в категориях геодаты могут (очень редко, но бывает) попадаться <code>regexp:</code> префиксы для доменов. Такие &quot;домены&quot; игнорируются опцией &quot;включить dns-обход&quot; и работать не будут, но это скажем так маленькая проблема.</p></div><h3 id="уровень-3-правила-маршрутизации-xray" tabindex="-1"><a class="header-anchor" href="#уровень-3-правила-маршрутизации-xray"><span>Уровень 3: Правила маршрутизации Xray</span></a></h3><p>Только трафик, который проходит через предыдущие уровни, достигает механизма маршрутизации Xray, где ваши правила оцениваются последовательно.</p><h2 id="понимание-префиксов-доменов" tabindex="-1"><a class="header-anchor" href="#понимание-префиксов-доменов"><span>Понимание префиксов доменов</span></a></h2><p>Маршрутизация доменов в Xray обеспечивает гибкое управление трафиком через различные подходы к сопоставлению. Понимание этих префиксов необходимо для эффективного создания правил.</p><h3 id="базовое-сопоставление-доменов" tabindex="-1"><a class="header-anchor" href="#базовое-сопоставление-доменов"><span>Базовое сопоставление доменов</span></a></h3><p>Префикс <code>domain:</code> является основой маршрутизации на основе доменов:</p><ul><li><p><strong><code>domain:com</code></strong> — Соответствует ВСЕМ доменам верхнего уровня .com и их поддоменам</p><ul><li>✅ Соответствует: <code>dmn.com</code>, <code>example.com</code>, <code>sub.example.com</code></li><li>❌ Не соответствует: <code>us.com</code>, <code>us-server.net</code></li></ul></li><li><p><strong><code>domain:dmn.com</code></strong> — Соответствует домену и всем его поддоменам</p><ul><li>✅ Соответствует: <code>dmn.com</code>, <code>www.dmn.com</code>, <code>some.sub.domain.dmn.com</code></li><li>❌ Не соответствует: <code>domains.com</code>, <code>notdmn.com</code></li></ul></li><li><p><strong><code>domain:www.dmn.com</code></strong> — Соответствует только этому конкретному поддомену и его под-поддоменам</p><ul><li>✅ Соответствует: <code>www.dmn.com</code>, <code>api.www.dmn.com</code></li><li>❌ Не соответствует: <code>dmn.com</code>, <code>m.dmn.com</code></li></ul></li></ul><h3 id="полное-сопоставление-доменов" tabindex="-1"><a class="header-anchor" href="#полное-сопоставление-доменов"><span>Полное сопоставление доменов</span></a></h3><p>Используйте <code>full:</code> когда вам нужно точное сопоставление домена без поддоменов:</p><ul><li><strong><code>full:google.com</code></strong> — Соответствует ТОЛЬКО <code>google.com</code><ul><li>✅ Соответствует: <code>google.com</code></li><li>❌ Не соответствует: <code>www.google.com</code>, <code>maps.google.com</code></li></ul></li></ul><h3 id="сопоставление-по-шаблону" tabindex="-1"><a class="header-anchor" href="#сопоставление-по-шаблону"><span>Сопоставление по шаблону</span></a></h3><p>Для более гибкого сопоставления используйте ключевые слова и шаблоны регулярных выражений:</p><ul><li><p><strong><code>keyword:google</code></strong> — Соответствует любому домену, содержащему &quot;google&quot;</p><ul><li>✅ Соответствует: <code>google.com</code>, <code>googleusercontent.com</code>, <code>mygooglesite.net</code></li></ul></li><li><p><strong><code>regexp:.*\.edu$</code></strong> — Соответствует доменам, заканчивающимся на .edu, используя регулярные выражения</p><ul><li>✅ Соответствует: <code>harvard.edu</code>, <code>mit.edu</code></li><li>❌ Не соответствует: <code>education.com</code></li></ul></li></ul><h2 id="работа-с-базами-данных-geosite" tabindex="-1"><a class="header-anchor" href="#работа-с-базами-данных-geosite"><span>Работа с базами данных Geosite</span></a></h2><p>Для эффективного управления большими коллекциями доменов Xray поддерживает файлы geosite. Это поддерживаемые сообществом базы данных, которые группируют сотни или тысячи связанных доменов под одним тегом.</p><h3 id="зачем-использовать-geosite" tabindex="-1"><a class="header-anchor" href="#зачем-использовать-geosite"><span>Зачем использовать Geosite?</span></a></h3><p>Вместо ручного перечисления десятков доменов для сервиса вроде YouTube:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">domain:youtube.com</span>
<span class="line">domain:youtube.ru</span>
<span class="line">domain:youtu.be</span>
<span class="line">domain:youtubeeducation.com</span>
<span class="line">domain:youtube-nocookie.com</span>
<span class="line">domain:googleapis.com</span>
<span class="line"># ... и многие другие</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Вы можете просто использовать:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">geosite:youtube</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Это автоматически включает ВСЕ домены, связанные с YouTube, из базы данных сообщества, включая CDN, конечные точки API и региональные варианты.</p><h3 id="доступные-категории-geosite" tabindex="-1"><a class="header-anchor" href="#доступные-категории-geosite"><span>Доступные категории Geosite</span></a></h3><p>Сообщество поддерживает обширные списки доменов. Вы можете найти все доступные категории на: <a href="https://github.com/v2fly/domain-list-community/tree/master/data" target="_blank" rel="noopener noreferrer">GitHub: v2fly/domain-list-community</a></p><p>Общие категории включают:</p><ul><li><code>geosite:google</code> — Все сервисы Google</li><li><code>geosite:youtube</code> — YouTube и связанные домены</li><li><code>geosite:netflix</code> — Стриминговый сервис Netflix</li><li><code>geosite:telegram</code> — Мессенджер Telegram</li><li><code>geosite:facebook</code> — Facebook и Instagram</li><li><code>geosite:twitter</code> — Платформа Twitter/X</li><li><code>geosite:cn</code> — Китайские веб-сайты</li><li><code>geosite:category-media-ru</code> - Все заблокированные медиа в России</li><li><code>geosite:category-ads-all</code> — Рекламные сети</li><li><code>geosite:geolocation-!cn</code> — Не китайские сайты</li></ul><h3 id="понимание-содержимого-категории" tabindex="-1"><a class="header-anchor" href="#понимание-содержимого-категории"><span>Понимание содержимого категорий</span></a></h3><p>Давайте рассмотрим, как работают категории на простом примере:</p><p>Категория <code>geosite:actalis</code> содержит всего два домена:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">domain:actalis.com</span>
<span class="line">domain:actalis.it</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>Когда вы используете <code>geosite:actalis</code>, это эквивалентно добавлению обоих доменов вручную. Однако ключевое преимущество — <strong>автоматические обновления</strong> — если сообщество добавит новые домены Actalis в будущем, ваши правила автоматически включат их при обновлении базы данных geosite.</p><h3 id="вклад-сообщества" tabindex="-1"><a class="header-anchor" href="#вклад-сообщества"><span>Вклад сообщества</span></a></h3><p>База данных geosite поддерживается сообществом. Например, категория <code>category-media-ru</code> была недавно добавлена:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">geosite:category-media-ru</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>Теперь это автоматически включает все домены, связанные с category-media-ru, без необходимости перечислять их индивидуально.</p><h3 id="создание-пользовательских-категории-geosite" tabindex="-1"><a class="header-anchor" href="#создание-пользовательских-категории-geosite"><span>Создание пользовательских категорий Geosite</span></a></h3><p>Вы можете создавать свои собственные списки доменов, используя функцию пользовательского geosite в xrayui: Подробнее читайте о <a href="/en/custom-geodata" target="_blank" rel="noopener noreferrer">пользовательских файлах geosite dat</a>.</p><h3 id="обновление-баз-данных-geosite" tabindex="-1"><a class="header-anchor" href="#обновление-баз-данных-geosite"><span>Обновление баз данных Geosite</span></a></h3><p>Базы данных geosite сообщества регулярно обновляются новыми доменами и категориями. Чтобы поддерживать точность маршрутизации:</p><h4 id="ручное-обновление" tabindex="-1"><a class="header-anchor" href="#ручное-обновление"><span>Ручное обновление</span></a></h4><ol><li>Перейдите в раздел <strong>Routing</strong></li><li>Нажмите кнопку <strong>Update community files</strong></li><li>Дождитесь завершения обновления</li><li>Примените конфигурацию</li></ol><h4 id="автоматические-обновления" tabindex="-1"><a class="header-anchor" href="#автоматические-обновления"><span>Автоматические обновления</span></a></h4><ol><li>Перейдите в <strong>General Options</strong> → вкладка <strong>Geodata</strong></li><li>Включите <strong>Auto-update geodata files</strong></li><li>Обновления будут происходить ночью в 03:00</li></ol><div class="hint-container tip"><p class="hint-container-title">Совет</p><p>Регулярные обновления гарантируют, что ваши правила будут захватывать недавно добавленные домены для сервисов, таких как стриминговые платформы, которые часто добавляют новые конечные точки CDN.</p></div><h3 id="проверка-содержимого-geosite" tabindex="-1"><a class="header-anchor" href="#проверка-содержимого-geosite"><span>Проверка содержимого Geosite</span></a></h3><p>Чтобы увидеть, какие домены включены в категорию geosite:</p><ol><li>Проверьте <a href="https://github.com/v2fly/domain-list-community/tree/master/data" target="_blank" rel="noopener noreferrer">официальный репозиторий</a></li><li>Найдите файл категории (например, <code>youtube</code>)</li><li>Просмотрите включенные домены и шаблоны</li></ol><p>Это поможет вам понять, какой именно трафик будет соответствовать вашим правилам.</p><h2 id="понимание-правил-маршрутизации" tabindex="-1"><a class="header-anchor" href="#понимание-правил-маршрутизации"><span>Понимание правил маршрутизации</span></a></h2><p>В <code>XRAYUI</code> правила маршрутизации работают как <strong>последовательное дерево решений</strong>. Когда поступает трафик, Xray оценивает правила сверху вниз и применяет <strong>первое совпадающее правило</strong>. Если ни одно правило не совпадает, используется поведение по умолчанию.</p><div class="hint-container important"><p class="hint-container-title">Важно</p><p>Порядок правил важен! Правила оцениваются последовательно, поэтому более конкретные правила обычно должны идти перед более общими.</p></div><h2 id="интерфеис-правил" tabindex="-1"><a class="header-anchor" href="#интерфеис-правил"><span>Интерфейс правил</span></a></h2><p>Для управления правилами маршрутизации в <code>XRAYUI</code>:</p><ol><li>Перейдите в раздел <strong>Routing</strong> на главной странице <img src="data:image/png;base64,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" alt=""></li><li>Нажмите кнопку <strong>Manage</strong> рядом с <strong>Rules</strong></li><li>Откроется окно менеджера правил <img src="/asuswrt-merlin-xrayui/assets/20251025011756-CGbahTR7.png" alt=""></li></ol><h2 id="добавление-нового-правила" tabindex="-1"><a class="header-anchor" href="#добавление-нового-правила"><span>Добавление нового правила</span></a></h2><h3 id="шаг-1-откроите-редактор-правил" tabindex="-1"><a class="header-anchor" href="#шаг-1-откроите-редактор-правил"><span>Шаг 1: Откройте редактор правил</span></a></h3><p>Нажмите <strong>Add new rule</strong> внизу окна менеджера правил.</p><h3 id="шаг-2-настроите-базовые-параметры" tabindex="-1"><a class="header-anchor" href="#шаг-2-настроите-базовые-параметры"><span>Шаг 2: Настройте базовые параметры</span></a></h3><table><thead><tr><th>Поле</th><th>Описание</th><th>Пример</th></tr></thead><tbody><tr><td><strong>Friendly Name</strong></td><td>Необязательное описательное имя правила</td><td>&quot;Netflix to Proxy&quot;</td></tr><tr><td><strong>Outbound connection</strong></td><td>Какое исходящее использовать при совпадении</td><td>proxy, direct, block</td></tr><tr><td><strong>Enabled</strong></td><td>Включить/выключить правило без удаления</td><td>✓ (отмечено)</td></tr></tbody></table><h3 id="шаг-3-определите-критерии-соответствия" tabindex="-1"><a class="header-anchor" href="#шаг-3-определите-критерии-соответствия"><span>Шаг 3: Определите критерии соответствия</span></a></h3><p><img src="/asuswrt-merlin-xrayui/assets/20251025011905-BEKkoQCM.png" alt=""></p><p>Правила могут соответствовать трафику на основе нескольких критериев:</p><h4 id="домены" tabindex="-1"><a class="header-anchor" href="#домены"><span>Домены</span></a></h4><p>Введите домены для соответствия, по одному на строку. Поддерживает несколько форматов:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># Точный домен и поддомены</span>
<span class="line">domain:google.com</span>
<span class="line"></span>
<span class="line"># Только точное совпадение</span>
<span class="line">full:www.google.com</span>
<span class="line"></span>
<span class="line"># Сопоставление по ключевому слову</span>
<span class="line">keyword:facebook</span>
<span class="line"></span>
<span class="line"># Регулярное выражение</span>
<span class="line">regexp:.*\.gov$</span>
<span class="line"></span>
<span class="line"># Базы данных Geosite</span>
<span class="line">geosite:netflix</span>
<span class="line">geosite:category-ads</span>
<span class="line">ext:xrayui:streaming</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><div class="hint-container tip"><p class="hint-container-title">Совет</p><p>Используйте кнопки <strong>geosite:</strong> и <strong>ext:xrayui:</strong> над полем домена для быстрой вставки префикса. Функция автозаполнения поможет вам найти доступные теги.</p></div><h4 id="ip-адреса" tabindex="-1"><a class="header-anchor" href="#ip-адреса"><span>IP-адреса</span></a></h4><p>Укажите IP-адреса или диапазоны CIDR:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># Один IP</span>
<span class="line">192.168.1.1</span>
<span class="line"></span>
<span class="line"># Диапазон CIDR</span>
<span class="line">192.168.1.0/24</span>
<span class="line"></span>
<span class="line"># Несколько IP/диапазонов</span>
<span class="line">10.0.0.0/8</span>
<span class="line">172.16.0.0/12</span>
<span class="line"></span>
<span class="line"># База данных GeoIP</span>
<span class="line">geoip:cn</span>
<span class="line">geoip:private</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="исходные-ip-адреса" tabindex="-1"><a class="header-anchor" href="#исходные-ip-адреса"><span>Исходные IP-адреса</span></a></h4><p>Соответствовать трафику от конкретных устройств:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">192.168.1.100</span>
<span class="line">192.168.1.0/24</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="порты" tabindex="-1"><a class="header-anchor" href="#порты"><span>Порты</span></a></h4><p>Определите порты назначения:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line"># Один порт</span>
<span class="line">443</span>
<span class="line"></span>
<span class="line"># Диапазон портов (используйте двоеточие, не дефис)</span>
<span class="line">8080:8090</span>
<span class="line"></span>
<span class="line"># Несколько портов/диапазонов</span>
<span class="line">80</span>
<span class="line">443</span>
<span class="line">8080:8090</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="сети" tabindex="-1"><a class="header-anchor" href="#сети"><span>Сети</span></a></h4><p>Выберите протоколы для соответствия:</p><ul><li><strong>tcp</strong>: Только TCP трафик</li><li><strong>udp</strong>: Только UDP трафик (включая QUIC/HTTP3)</li><li><em>Оставьте пустым для обоих</em></li></ul><h4 id="протоколы" tabindex="-1"><a class="header-anchor" href="#протоколы"><span>Протоколы</span></a></h4><p>Соответствовать конкретным протоколам приложений:</p><ul><li><strong>http</strong>: HTTP трафик</li><li><strong>tls</strong>: HTTPS/TLS трафик</li><li><strong>bittorrent</strong>: Торрент трафик</li><li><strong>quic</strong>: QUIC/HTTP3 трафик</li></ul><div class="hint-container note"><p class="hint-container-title">Заметка</p><p>Обнаружение протоколов работает путем проверки содержимого пакетов, а не только портов.</p></div><h3 id="шаг-4-установите-приоритет-правила" tabindex="-1"><a class="header-anchor" href="#шаг-4-установите-приоритет-правила"><span>Шаг 4: Установите приоритет правила</span></a></h3><p>Используйте кнопки вверх/вниз для изменения порядка правил. Помните: первое совпадающее правило выигрывает!</p><h3 id="шаг-5-сохраните-и-примените" tabindex="-1"><a class="header-anchor" href="#шаг-5-сохраните-и-примените"><span>Шаг 5: Сохраните и примените</span></a></h3><ol><li>Нажмите <strong>Save</strong> в редакторе правил</li><li>Нажмите <strong>Apply</strong> на главной странице для активации изменений</li></ol><h2 id="примеры-правил" tabindex="-1"><a class="header-anchor" href="#примеры-правил"><span>Примеры правил</span></a></h2><h3 id="пример-1-направить-netflix-через-прокси" tabindex="-1"><a class="header-anchor" href="#пример-1-направить-netflix-через-прокси"><span>Пример 1: Направить Netflix через прокси</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">Friendly Name</span><span class="token punctuation">:</span> Netflix через прокси</span>
<span class="line"><span class="token key atrule">Outbound</span><span class="token punctuation">:</span> proxy</span>
<span class="line"><span class="token key atrule">Domains</span><span class="token punctuation">:</span> geosite<span class="token punctuation">:</span>netflix</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="пример-2-блокировать-рекламу" tabindex="-1"><a class="header-anchor" href="#пример-2-блокировать-рекламу"><span>Пример 2: Блокировать рекламу</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">Friendly Name</span><span class="token punctuation">:</span> Блокировка рекламы</span>
<span class="line"><span class="token key atrule">Outbound</span><span class="token punctuation">:</span> block</span>
<span class="line"><span class="token key atrule">Domains</span><span class="token punctuation">:</span> geosite<span class="token punctuation">:</span>category<span class="token punctuation">-</span>ads<span class="token punctuation">-</span>all</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="пример-3-прямое-соединение-для-локальных-сервисов" tabindex="-1"><a class="header-anchor" href="#пример-3-прямое-соединение-для-локальных-сервисов"><span>Пример 3: Прямое соединение для локальных сервисов</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">Friendly Name</span><span class="token punctuation">:</span> Локальная сеть прямо</span>
<span class="line"><span class="token key atrule">Outbound</span><span class="token punctuation">:</span> direct</span>
<span class="line"><span class="token key atrule">IPs</span><span class="token punctuation">:</span> 192.168.1.0/24</span>
<span class="line">  10.0.0.0/8</span>
<span class="line">  geoip<span class="token punctuation">:</span>private</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="пример-4-направить-https-трафик-конкретного-устроиства" tabindex="-1"><a class="header-anchor" href="#пример-4-направить-https-трафик-конкретного-устроиства"><span>Пример 4: Направить HTTPS трафик конкретного устройства</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">Friendly Name</span><span class="token punctuation">:</span> Ноутбук HTTPS через прокси</span>
<span class="line"><span class="token key atrule">Outbound</span><span class="token punctuation">:</span> proxy</span>
<span class="line"><span class="token key atrule">Source IPs</span><span class="token punctuation">:</span> 192.168.1.100</span>
<span class="line"><span class="token key atrule">Ports</span><span class="token punctuation">:</span> <span class="token number">443</span></span>
<span class="line"><span class="token key atrule">Networks</span><span class="token punctuation">:</span> tcp</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="пример-5-обоити-торрент-трафик" tabindex="-1"><a class="header-anchor" href="#пример-5-обоити-торрент-трафик"><span>Пример 5: Обойти торрент трафик</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">Friendly Name</span><span class="token punctuation">:</span> Торренты прямо</span>
<span class="line"><span class="token key atrule">Outbound</span><span class="token punctuation">:</span> direct</span>
<span class="line"><span class="token key atrule">Protocols</span><span class="token punctuation">:</span> bittorrent</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="специальные-функции-правил" tabindex="-1"><a class="header-anchor" href="#специальные-функции-правил"><span>Специальные функции правил</span></a></h2><h3 id="системные-правила-только-для-чтения" tabindex="-1"><a class="header-anchor" href="#системные-правила-только-для-чтения"><span>Системные правила (Только для чтения)</span></a></h3><p>Некоторые правила автоматически генерируются системой:</p><ul><li><strong>DNS правила</strong>: Управляют трафиком DNS разрешения</li><li><strong>Правила политик B/R</strong>: Генерируются из ваших настроек обхода/перенаправления</li></ul><p>Эти правила нельзя редактировать напрямую, но их можно отключить.</p><h3 id="группы-правил" tabindex="-1"><a class="header-anchor" href="#группы-правил"><span>Группы правил</span></a></h3><p>Организуйте связанные правила вместе:</p><ol><li>Создайте правила с похожими именами</li><li>Используйте согласованные префиксы имен (например, &quot;Streaming: Netflix&quot;, &quot;Streaming: YouTube&quot;)</li><li>Расположите их последовательно в списке правил</li></ol><h2 id="проверка-и-отладка-правил" tabindex="-1"><a class="header-anchor" href="#проверка-и-отладка-правил"><span>Проверка и отладка правил</span></a></h2><h3 id="используите-правила-логирования" tabindex="-1"><a class="header-anchor" href="#используите-правила-логирования"><span>Используйте правила логирования</span></a></h3><p>Создайте временные правила для тестирования:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">Friendly Name</span><span class="token punctuation">:</span> ТЕСТ <span class="token punctuation">-</span> Лог трафика Google</span>
<span class="line"><span class="token key atrule">Outbound</span><span class="token punctuation">:</span> direct</span>
<span class="line"><span class="token key atrule">Domains</span><span class="token punctuation">:</span> domain<span class="token punctuation">:</span>google.com</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>Включите логирование и наблюдайте, когда это правило срабатывает.</p><h3 id="проверка-порядка-правил" tabindex="-1"><a class="header-anchor" href="#проверка-порядка-правил"><span>Проверка порядка правил</span></a></h3><ol><li>Более конкретные правила первыми</li><li>Региональные блокировки перед общими проксями</li><li>Правила исключений перед catch-all правилами</li></ol><h3 id="использование-инструментов-диагностики" tabindex="-1"><a class="header-anchor" href="#использование-инструментов-диагностики"><span>Использование инструментов диагностики</span></a></h3><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token comment"># Проверка, какое правило соответствует</span></span>
<span class="line"><span class="token function">tail</span> <span class="token parameter variable">-f</span> /tmp/log/xray_access.log</span>
<span class="line"></span>
<span class="line"><span class="token comment"># Мониторинг живого трафика</span></span>
<span class="line">tcpdump <span class="token parameter variable">-i</span> any <span class="token parameter variable">-n</span> <span class="token function">host</span> example.com</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="интеграция-с-другими-функциями" tabindex="-1"><a class="header-anchor" href="#интеграция-с-другими-функциями"><span>Интеграция с другими функциями</span></a></h2><h3 id="dns-обход-и-правила" tabindex="-1"><a class="header-anchor" href="#dns-обход-и-правила"><span>DNS обход и правила</span></a></h3><p><strong>Сценарий</strong>: У вас есть правила для направления Netflix через прокси</p><ul><li>Если DNS обход = BYPASS, Netflix может обойти Xray перед оценкой правила</li><li>Если DNS обход = REDIRECT, только не-FREEDOM трафик достигает ваших правил</li><li>Если DNS обход = OFF, все правила оцениваются нормально</li></ul><h3 id="пользовательские-списки-geosite" tabindex="-1"><a class="header-anchor" href="#пользовательские-списки-geosite"><span>Пользовательские списки Geosite</span></a></h3><p>Вы можете создавать пользовательские категории доменов:</p><ol><li>Перейдите в <strong>Routing</strong> → <strong>Custom geosite dat files</strong></li><li>Создайте новую категорию (например, &quot;mywork&quot;)</li><li>Добавьте домены</li><li>Используйте в правилах: <code>ext:xrayui:mywork</code></li></ol><h3 id="балансировщики-и-резервные-варианты" tabindex="-1"><a class="header-anchor" href="#балансировщики-и-резервные-варианты"><span>Балансировщики и резервные варианты</span></a></h3><p>Правила могут направлять на балансировщики вместо одного исходящего:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">Outbound</span><span class="token punctuation">:</span> balancer<span class="token punctuation">-</span>us</span>
<span class="line"><span class="token comment"># Направляет на несколько серверов US с балансировкой нагрузки</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="распространенные-настроики" tabindex="-1"><a class="header-anchor" href="#распространенные-настроики"><span>Распространенные настройки</span></a></h2><h3 id="конфигурация-проксировать-все-кроме-локального" tabindex="-1"><a class="header-anchor" href="#конфигурация-проксировать-все-кроме-локального"><span>Конфигурация &quot;Проксировать всё, кроме локального&quot;</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">Правило 1</span><span class="token punctuation">:</span> Локальные IP прямо</span>
<span class="line">  <span class="token key atrule">Outbound</span><span class="token punctuation">:</span> direct</span>
<span class="line">  <span class="token key atrule">IPs</span><span class="token punctuation">:</span> geoip<span class="token punctuation">:</span>private</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">Правило 2</span><span class="token punctuation">:</span> Китайские сайты прямо</span>
<span class="line">  <span class="token key atrule">Outbound</span><span class="token punctuation">:</span> direct</span>
<span class="line">  <span class="token key atrule">Domains</span><span class="token punctuation">:</span> geosite<span class="token punctuation">:</span>cn</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">Правило 3</span><span class="token punctuation">:</span> Всё остальное через прокси</span>
<span class="line">  <span class="token key atrule">Outbound</span><span class="token punctuation">:</span> proxy</span>
<span class="line">  <span class="token comment"># Оставить все критерии пустыми для catch-all</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="конфигурация-только-конкретные-сервисы" tabindex="-1"><a class="header-anchor" href="#конфигурация-только-конкретные-сервисы"><span>Конфигурация &quot;Только конкретные сервисы&quot;</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">Правило 1</span><span class="token punctuation">:</span> Стриминговые сервисы</span>
<span class="line">  <span class="token key atrule">Outbound</span><span class="token punctuation">:</span> proxy</span>
<span class="line">  <span class="token key atrule">Domains</span><span class="token punctuation">:</span></span>
<span class="line">    geosite<span class="token punctuation">:</span>netflix</span>
<span class="line">    geosite<span class="token punctuation">:</span>youtube</span>
<span class="line">    geosite<span class="token punctuation">:</span>twitch</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">Правило 2</span><span class="token punctuation">:</span> Всё остальное прямо</span>
<span class="line">  <span class="token key atrule">Outbound</span><span class="token punctuation">:</span> direct</span>
<span class="line">  <span class="token comment"># Пустые критерии = catch-all</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="конфигурация-обход-региональных-ограничении" tabindex="-1"><a class="header-anchor" href="#конфигурация-обход-региональных-ограничении"><span>Конфигурация &quot;Обход региональных ограничений&quot;</span></a></h3><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token key atrule">Правило 1</span><span class="token punctuation">:</span> Заблокированные медиа в России</span>
<span class="line">  <span class="token key atrule">Outbound</span><span class="token punctuation">:</span> proxy</span>
<span class="line">  <span class="token key atrule">Domains</span><span class="token punctuation">:</span> geosite<span class="token punctuation">:</span>category<span class="token punctuation">-</span>media<span class="token punctuation">-</span>ru</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">Правило 2</span><span class="token punctuation">:</span> Российские сервисы прямо</span>
<span class="line">  <span class="token key atrule">Outbound</span><span class="token punctuation">:</span> direct</span>
<span class="line">  <span class="token key atrule">Domains</span><span class="token punctuation">:</span> geosite<span class="token punctuation">:</span>ru</span>
<span class="line"></span>
<span class="line"><span class="token key atrule">Правило 3</span><span class="token punctuation">:</span> Международные сервисы</span>
<span class="line">  <span class="token key atrule">Outbound</span><span class="token punctuation">:</span> proxy</span>
<span class="line">  <span class="token key atrule">Domains</span><span class="token punctuation">:</span> geosite<span class="token punctuation">:</span>geolocation<span class="token punctuation">-</span><span class="token tag">!ru</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="список-доступных-тегов-geosite" tabindex="-1"><a class="header-anchor" href="#список-доступных-тегов-geosite"><span>Список доступных тегов Geosite</span></a></h2><h3 id="региональные-категории" tabindex="-1"><a class="header-anchor" href="#региональные-категории"><span>Региональные категории</span></a></h3><ul><li><code>geosite:cn</code> - Китайские домены</li><li><code>geosite:ru</code> - Российские домены</li><li><code>geosite:us</code> - Американские домены</li><li><code>geosite:uk</code> - Британские домены</li><li><code>geosite:jp</code> - Японские домены</li></ul><h3 id="категории-сервисов" tabindex="-1"><a class="header-anchor" href="#категории-сервисов"><span>Категории сервисов</span></a></h3><ul><li><code>geosite:google</code> - Сервисы Google</li><li><code>geosite:youtube</code> - YouTube</li><li><code>geosite:facebook</code> - Facebook &amp; Instagram</li><li><code>geosite:twitter</code> - Twitter/X</li><li><code>geosite:telegram</code> - Telegram</li><li><code>geosite:netflix</code> - Netflix</li><li><code>geosite:spotify</code> - Spotify</li></ul><h3 id="специальные-категории" tabindex="-1"><a class="header-anchor" href="#специальные-категории"><span>Специальные категории</span></a></h3><ul><li><code>geosite:category-ads-all</code> - Все рекламные сети</li><li><code>geosite:category-media-ru</code> - Заблокированные медиа в России</li><li><code>geosite:geolocation-!cn</code> - Не китайские домены</li><li><code>geosite:tld-cn</code> - Китайские домены верхнего уровня</li></ul><h2 id="распространенные-теги-geoip" tabindex="-1"><a class="header-anchor" href="#распространенные-теги-geoip"><span>Распространенные теги GeoIP</span></a></h2><ul><li><code>geoip:cn</code> - Китайские IP-адреса</li><li><code>geoip:us</code> - IP-адреса США</li><li><code>geoip:private</code> - Частные/LAN адреса</li><li><code>geoip:cloudflare</code> - IP-адреса Cloudflare</li></ul><h3 id="пользовательские-фаилы-geosite" tabindex="-1"><a class="header-anchor" href="#пользовательские-фаилы-geosite"><span>Пользовательские файлы Geosite</span></a></h3><p>Вы можете создавать пользовательские списки доменов. Подробности смотрите в <a href="custom-geodata">Пользовательские файлы Geosite</a>.</p><h2 id="продвинутые-функции" tabindex="-1"><a class="header-anchor" href="#продвинутые-функции"><span>Продвинутые функции</span></a></h2><h3 id="стратегии-сопоставления-доменов" tabindex="-1"><a class="header-anchor" href="#стратегии-сопоставления-доменов"><span>Стратегии сопоставления доменов</span></a></h3><p>Установите <strong>Domain Matcher</strong> для оптимизации производительности:</p><ul><li><strong>hybrid</strong> (по умолчанию): Сбалансированная производительность и точность</li><li><strong>linear</strong>: Последовательное сопоставление, более точное, но медленнее</li></ul><p><img src="/asuswrt-merlin-xrayui/assets/20251025013437-CXUmHJ-f.png" alt=""></p><h3 id="использование-нескольких-критериев" tabindex="-1"><a class="header-anchor" href="#использование-нескольких-критериев"><span>Использование нескольких критериев</span></a></h3><p>Правила с несколькими критериями используют логику И. Правило совпадает только когда <strong>ВСЕ</strong> указанные условия выполнены:</p><div class="language-yaml line-numbers-mode" data-highlighter="prismjs" data-ext="yml"><pre><code class="language-yaml"><span class="line"><span class="token comment"># Это правило соответствует HTTPS трафику от 192.168.1.100</span></span>
<span class="line"><span class="token key atrule">Domains</span><span class="token punctuation">:</span> domain<span class="token punctuation">:</span>example.com</span>
<span class="line"><span class="token key atrule">Source IPs</span><span class="token punctuation">:</span> 192.168.1.100</span>
<span class="line"><span class="token key atrule">Ports</span><span class="token punctuation">:</span> <span class="token number">443</span></span>
<span class="line"><span class="token comment"># ВСЕ три условия должны быть истинными для совпадения</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="временное-отключение-правил" tabindex="-1"><a class="header-anchor" href="#временное-отключение-правил"><span>Временное отключение правил</span></a></h3><p>Вместо удаления правил, вы можете временно их отключить:</p><ol><li>Снимите флажок рядом с именем правила</li><li>Правило перемещается в раздел &quot;отключенные&quot;, но сохраняет свою конфигурацию</li><li>Включите снова при необходимости без переконфигурации</li></ol><h2 id="лучшие-практики" tabindex="-1"><a class="header-anchor" href="#лучшие-практики"><span>Лучшие практики</span></a></h2><h3 id="_1-начинаите-с-конкретного-затем-обобщаите" tabindex="-1"><a class="header-anchor" href="#_1-начинаите-с-конкретного-затем-обобщаите"><span>1. Начинайте с конкретного, затем обобщайте</span></a></h3><p>Начните с конкретных правил для критических сервисов, затем добавьте более общие catch-all правила.</p><h3 id="_2-используите-описательные-имена" tabindex="-1"><a class="header-anchor" href="#_2-используите-описательные-имена"><span>2. Используйте описательные имена</span></a></h3><p>Давайте правилам осмысленные имена, описывающие их назначение:</p><ul><li>✅ &quot;Netflix через прокси&quot;</li><li>❌ &quot;Правило 1&quot;</li></ul><h3 id="_3-группируите-связанные-правила" tabindex="-1"><a class="header-anchor" href="#_3-группируите-связанные-правила"><span>3. Группируйте связанные правила</span></a></h3><p>Держите похожие правила вместе для удобства управления:</p><ul><li>Группируйте все правила стриминга</li><li>Группируйте все правила блокировки</li><li>Группируйте все правила для конкретных устройств</li></ul><h3 id="_4-тестируите-перед-развертыванием" tabindex="-1"><a class="header-anchor" href="#_4-тестируите-перед-развертыванием"><span>4. Тестируйте перед развертыванием</span></a></h3><ol><li>Добавляйте новые правила как отключенные</li><li>Включайте и тестируйте индивидуально</li><li>Мониторьте логи на предмет неожиданного поведения</li><li>Корректируйте по необходимости</li></ol><h3 id="_5-регулярное-обслуживание" tabindex="-1"><a class="header-anchor" href="#_5-регулярное-обслуживание"><span>5. Регулярное обслуживание</span></a></h3><ul><li>Периодически просматривайте правила</li><li>Удаляйте устаревшие правила</li><li>Регулярно обновляйте базы данных geosite/geoip</li><li>Объединяйте похожие правила, когда возможно</li></ul><h3 id="_6-документируите-сложные-правила" tabindex="-1"><a class="header-anchor" href="#_6-документируите-сложные-правила"><span>6. Документируйте сложные правила</span></a></h3><p>Для сложных регулярных выражений или многоусловных правил добавляйте четкие имена и рассмотрите ведение внешней документации.</p><h2 id="устранение-неполадок" tabindex="-1"><a class="header-anchor" href="#устранение-неполадок"><span>Устранение неполадок</span></a></h2><h3 id="правила-не-работают" tabindex="-1"><a class="header-anchor" href="#правила-не-работают"><span>Правила не работают</span></a></h3><ol><li><p><strong>Проверьте режим DNS обхода</strong> - Ваши правила могут не достигаться из-за DNS обхода</p><ul><li>Если используете BYPASS/REDIRECT, проверьте, не обрабатываются ли домены до Xray</li><li>Попробуйте временно отключить DNS обход для изоляции проблемы</li></ul></li><li><p><strong>Проверьте политики B/R</strong> - Трафик может вообще не перехватываться</p><ul><li>Проверьте, настроено ли устройство/порт на перенаправление в Xray</li><li>Проверьте MAC-адреса и диапазоны портов</li></ul></li><li><p><strong>Проверьте порядок правил</strong> - Более конкретные правила должны идти перед общими</p></li><li><p><strong>Проверьте теги исходящих</strong> - Убедитесь, что указанное исходящее существует</p></li><li><p><strong>Проверьте синтаксис</strong> - Проверьте форматы доменов/IP</p><ul><li>Помните: <code>domain:</code> а не <code>domain.</code></li><li>Используйте <code>geosite:</code> а не <code>geosite.</code></li></ul></li><li><p><strong>Просмотрите логи</strong> - Включите логи, чтобы увидеть, какие правила срабатывают</p></li></ol><h3 id="трафик-не-идет-через-прокси" tabindex="-1"><a class="header-anchor" href="#трафик-не-идет-через-прокси"><span>Трафик не идет через прокси</span></a></h3><p><strong>Симптом</strong>: Сайты загружаются, но не проксируются, несмотря на наличие правил</p><p><strong>Распространенные причины</strong>:</p><ol><li><strong>DNS обход включен</strong> с режимом REDIRECT и домен соответствует FREEDOM</li><li><strong>Политика B/R</strong> не включает используемые порты</li><li><strong>DNS разрешение</strong> происходит перед прокси (проверьте предотвращение утечки DNS)</li><li><strong>QUIC/HTTP3</strong> трафик на UDP 443 не перехватывается</li></ol><p><strong>Шаги решения</strong>:</p><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token number">1</span>. Временно установите DNS обход в OFF</span>
<span class="line"><span class="token number">2</span>. Убедитесь, что политика B/R включает и TCP, и UDP</span>
<span class="line"><span class="token number">3</span>. Добавьте UDP порт <span class="token number">443</span> в вашу политику перенаправления</span>
<span class="line"><span class="token number">4</span>. Проверьте логи, чтобы убедиться, что трафик достигает Xray</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="неожиданные-прямые-соединения" tabindex="-1"><a class="header-anchor" href="#неожиданные-прямые-соединения"><span>Неожиданные прямые соединения</span></a></h3><p><strong>Симптом</strong>: Некоторый трафик обходит прокси без соответствия какому-либо правилу прямого соединения</p><p><strong>Проверьте</strong>:</p><ol><li><strong>Правила ipset</strong> от DNS обхода, создающие обходы на уровне ядра</li><li><strong>Системные DNS</strong> запросы не перехватываются</li><li><strong>IPv6 трафик</strong>, если не обрабатывается правильно</li><li><strong>Кэшированные DNS</strong> ответы от предыдущего изменения конфигурации</li></ol><h3 id="проблемы-с-производительностью" tabindex="-1"><a class="header-anchor" href="#проблемы-с-производительностью"><span>Проблемы с производительностью</span></a></h3><p>Если маршрутизация медленная:</p><ol><li>Уменьшите использование регулярных выражений (наиболее ресурсоемкие)</li><li>Объедините похожие правила</li><li>Используйте теги geosite вместо перечисления многих доменов</li><li>Переключите сопоставитель доменов на &quot;linear&quot;, если точность важнее скорости</li></ol><h3 id="отладка-правил" tabindex="-1"><a class="header-anchor" href="#отладка-правил"><span>Отладка правил</span></a></h3><p>Включите логирование для просмотра совпадений правил:</p><ol><li>Перейдите в <strong>General Options</strong> → <strong>Logs</strong></li><li>Включите <strong>Access logs</strong></li><li>Установите <strong>Log level</strong> в &quot;info&quot; или &quot;debug&quot;</li><li>Проверяйте логи, чтобы увидеть, какие правила срабатывают</li></ol><h3 id="распространенные-ошибки-которых-следует-избегать" tabindex="-1"><a class="header-anchor" href="#распространенные-ошибки-которых-следует-избегать"><span>Распространенные ошибки, которых следует избегать</span></a></h3><ul><li><strong>Неправильный формат префикса</strong>: Используйте <code>domain:</code> а не <code>domain.</code></li><li><strong>Путаница с форматом порта</strong>: Используйте <code>:</code> для диапазонов (8080:8090), а не <code>-</code></li><li><strong>Отсутствующий тип сети</strong>: Укажите tcp, udp или оба</li><li><strong>Неправильный порядок правил</strong>: Catch-all правила размещены слишком рано</li><li><strong>Конфликтующие правила</strong>: Несколько правил соответствуют одному и тому же трафику</li></ul><h2 id="краткии-справочник" tabindex="-1"><a class="header-anchor" href="#краткии-справочник"><span>Краткий справочник</span></a></h2><h3 id="префиксы-доменов" tabindex="-1"><a class="header-anchor" href="#префиксы-доменов"><span>Префиксы доменов</span></a></h3><table><thead><tr><th>Префикс</th><th>Соответствует</th><th>Пример</th></tr></thead><tbody><tr><td><code>domain:</code></td><td>Домен и все поддомены</td><td><code>domain:google.com</code> совпадает с <code>maps.google.com</code></td></tr><tr><td><code>full:</code></td><td>Только точный домен</td><td><code>full:google.com</code> совпадает только с <code>google.com</code></td></tr><tr><td><code>keyword:</code></td><td>Содержит ключевое слово</td><td><code>keyword:google</code> совпадает с <code>googleplex.com</code></td></tr><tr><td><code>regexp:</code></td><td>Регулярное выражение</td><td><code>regexp:.*\.edu$</code> совпадает с доменами <code>.edu</code></td></tr><tr><td><code>geosite:</code></td><td>База данных Geosite</td><td><code>geosite:netflix</code></td></tr><tr><td><code>ext:xrayui:</code></td><td>Пользовательские списки xrayui</td><td><code>ext:xrayui:mylist</code></td></tr></tbody></table><h2 id="дерево-решении-конфигурации" tabindex="-1"><a class="header-anchor" href="#дерево-решении-конфигурации"><span>Дерево решений конфигурации</span></a></h2><p>При настройке маршрутизации в xrayui следуйте этому дереву решений:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">1. Сколько трафика нужно проксировать?</span>
<span class="line">   ├─ Большая часть трафика → DNS обход OFF</span>
<span class="line">   └─ Выборочно → DNS обход ON</span>
<span class="line">       ├─ Проксировать конкретные сайты → режим REDIRECT</span>
<span class="line">       └─ Обходить конкретные сайты → режим BYPASS</span>
<span class="line"></span>
<span class="line">2. Какие устройства нужно проксировать?</span>
<span class="line">   ├─ Все устройства → Политика B/R: Перенаправить все</span>
<span class="line">   └─ Конкретные устройства → Политика B/R: По MAC/IP</span>
<span class="line"></span>
<span class="line">3. Какие порты перехватывать?</span>
<span class="line">   ├─ Только веб → TCP/UDP 80,443</span>
<span class="line">   ├─ Весь трафик → Все порты</span>
<span class="line">   └─ Пользовательские приложения → Конкретные диапазоны портов</span>
<span class="line"></span>
<span class="line">4. Насколько сложна маршрутизация?</span>
<span class="line">   ├─ Простая (прокси/прямо) → Базовые правила</span>
<span class="line">   ├─ По сервису → Используйте категории geosite</span>
<span class="line">   └─ Сложная логика → Несколько уровней правил</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="резюме" tabindex="-1"><a class="header-anchor" href="#резюме"><span>Резюме</span></a></h2><p>Эффективная маршрутизация в xrayui требует понимания трех уровней:</p><h3 id="уровень-1-политики-b-r" tabindex="-1"><a class="header-anchor" href="#уровень-1-политики-b-r"><span>Уровень 1: Политики B/R</span></a></h3><p>Контролирует, какие устройства и порты перехватываются системой.</p><h3 id="уровень-2-dns-обход" tabindex="-1"><a class="header-anchor" href="#уровень-2-dns-обход"><span>Уровень 2: DNS обход</span></a></h3><p>Предварительно фильтрует трафик перед Xray, улучшая производительность, но снижая контроль.</p><h3 id="уровень-3-правила-маршрутизации-xray-1" tabindex="-1"><a class="header-anchor" href="#уровень-3-правила-маршрутизации-xray-1"><span>Уровень 3: Правила маршрутизации Xray</span></a></h3><p>Детальный контроль над трафиком, который достигает Xray.</p><p><strong>Ключевые концепции для запоминания:</strong></p><ul><li>Не весь трафик автоматически проходит через Xray</li><li>DNS обход может помешать оценке правил</li><li>Порядок правил важен (первое совпадение выигрывает)</li><li>Категории Geosite упрощают управление доменами</li><li>Разные префиксы доменов служат разным целям</li><li>Производительность и контроль часто являются компромиссами</li></ul><p><strong>Лучшие практики:</strong></p><ol><li>Начните с DNS обхода OFF, чтобы понять поток трафика</li><li>Используйте категории geosite вместо перечисления отдельных доменов</li><li>Тестируйте правила пошагово</li><li>Мониторьте логи во время первоначальной настройки</li><li>Оптимизируйте с DNS обходом после правильной работы маршрутизации</li><li>Документируйте сложные конфигурации</li></ol><div class="hint-container note"><p class="hint-container-title">Заметка</p><p>Не забудьте нажать <strong>Apply</strong> на главной странице после внесения любых изменений конфигурации для активации вашей новой настройки маршрутизации.</p></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">Последнее обновление: </span><time class="meta-item-info" datetime="2025-10-25T00:05:18.000Z" data-allow-mismatch>25.10.2025, 00:05</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: lavrushin@gmail.com">Daniel Lavrushin</span><!----><!--]--><!--]--></span></div></div></footer><nav class="vp-page-nav" aria-label="page navigation"><a class="route-link auto-link prev" href="/asuswrt-merlin-xrayui/ru/interface" aria-label="Обзор интерфейса"><!--[--><div class="hint"><span class="arrow left"></span> Prev</div><div class="link"><span class="external-link">Обзор интерфейса</span></div><!--]--></a><a class="route-link auto-link next" href="/asuswrt-merlin-xrayui/ru/general-options" aria-label="Общие параметры"><!--[--><div class="hint">Next <span class="arrow right"></span></div><div class="link"><span class="external-link">Общие параметры</span></div><!--]--></a></nav><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/asuswrt-merlin-xrayui/assets/app-eTybrgsj.js" defer></script>
  </body>
</html>
